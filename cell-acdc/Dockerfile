FROM registry.git.embl.org/grp-cbbcs/abcdesktop-apps/base-image:ubuntu22-cuda-11-8
USER root

ENV LANG=C.UTF-8 LC_ALL=C.UTF-8
ENV QT_XCB_NO_MITSHM=1
ENV NVIDIA_DRIVER_CAPABILITIES "compute,utility"
ENV CONDA_BIN_PATH="/opt/conda/bin"
ENV PATH $CONDA_BIN_PATH:$PATH
ENV BIOIMAGEIO_CACHE_PATH="/tmp/$CURRENT_USER/pybio_cache"
ENV CURRENT_USER=`whoami`
ENV LD_LIBRARY_PATH="/opt/conda/envs/acdc/libs:$LD_LIBRARY_PATH"

RUN DEBIAN_FRONTEND=noninteractive apt-get update -y && apt-get install -y bzip2 wget ca-certificates curl firefox \
    && echo 'debconf debconf/frontend select Noninteractive' | debconf-set-selections

RUN DEBIAN_FRONTEND=noninteractive apt-get install -y build-essential \
	libglu1-mesa-dev \
	libgl1-mesa-glx \
	nautilus \
        xdg-utils \
        wget \
        konsole \
        git \
        libblas-dev \
        liblapack-dev \
        libgl1 \
        mesa-utils \
        libxcb-cursor0 \
        libxcb-xinerama0 \
        libatlas-base-dev \
        gfortran \
        apt-utils \
        bzip2 \
        ca-certificates \
        curl \
        locales \
        libarchive-dev \
        cmake \
        libxcb-cursor-dev \
        unzip &&  apt-get clean && \
        rm -rf /var/lib/apt/lists/* && \
        sed -i '/en_US.UTF-8/s/^# //g' /etc/locale.gen && \
        locale-gen

RUN wget https://github.com/conda-forge/miniforge/releases/latest/download/Miniforge3-Linux-x86_64.sh \
    && bash Miniforge3-Linux-x86_64.sh -b -p /opt/conda \
    && rm -f Miniforge3-Linux-x86_64.sh 

RUN  conda create --name acdc --yes python=3.10 -c conda-forge \
     && /opt/conda/envs/acdc/bin/pip install --upgrade pip \
     && /opt/conda/envs/acdc/bin/pip install torch==2.5.1 torchvision==0.20.1 torchaudio==2.5.1 --index-url https://download.pytorch.org/whl/cu118 \
     && /opt/conda/envs/acdc/bin/pip install 'tensorflow[and-cuda]' \
     && /opt/conda/envs/acdc/bin/pip install git+https://github.com/SchmollerLab/Cell_ACDC \
     && /opt/conda/envs/acdc/bin/pip install PyQt6==6.6.0 PyQt6-Qt6==6.6.0 qtpy pyqtgraph seaborn tables 
  
LABEL oc.icon="cell-acdc.svg"
LABEL oc.icondata="PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcKICAgdmVyc2lvbj0iMS4xIgogICBpZD0iTGF5ZXJfMSIKICAgeD0iMHB4IgogICB5PSIwcHgiCiAgIHZpZXdCb3g9IjAgMCA5Ni40IDk2LjQiCiAgIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDk2LjQgOTYuNDsiCiAgIHhtbDpzcGFjZT0icHJlc2VydmUiCiAgIHNvZGlwb2RpOmRvY25hbWU9ImxvZ28uc3ZnIgogICBpbmtzY2FwZTp2ZXJzaW9uPSIxLjEuMiAoYjhlMjViZTgsIDIwMjItMDItMDUpIgogICBpbmtzY2FwZTpleHBvcnQtZmlsZW5hbWU9Ii9Wb2x1bWVzL0dvb2dsZURyaXZlLTEwODU1MzU3OTQzMDYzNTk3OTk0My9NeSBEcml2ZS8wMV9Qb3N0ZG9jX0hNR1UvUHl0aG9uX015U2NyaXB0cy9NSUEvR2l0L0NlbGxfQUNEQy9jZWxsYWNkYy9yZXNvdXJjZXMvbG9nby5wbmciCiAgIGlua3NjYXBlOmV4cG9ydC14ZHBpPSI5NiIKICAgaW5rc2NhcGU6ZXhwb3J0LXlkcGk9Ijk2IgogICB4bWxuczppbmtzY2FwZT0iaHR0cDovL3d3dy5pbmtzY2FwZS5vcmcvbmFtZXNwYWNlcy9pbmtzY2FwZSIKICAgeG1sbnM6c29kaXBvZGk9Imh0dHA6Ly9zb2RpcG9kaS5zb3VyY2Vmb3JnZS5uZXQvRFREL3NvZGlwb2RpLTAuZHRkIgogICB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIKICAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiCiAgIHhtbG5zOmNjPSJodHRwOi8vY3JlYXRpdmVjb21tb25zLm9yZy9ucyMiCiAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyI+PG1ldGFkYXRhCiAgIGlkPSJtZXRhZGF0YTMzIj48cmRmOlJERj48Y2M6V29yawogICAgICAgcmRmOmFib3V0PSIiPjxkYzpmb3JtYXQ+aW1hZ2Uvc3ZnK3htbDwvZGM6Zm9ybWF0PjxkYzp0eXBlCiAgICAgICAgIHJkZjpyZXNvdXJjZT0iaHR0cDovL3B1cmwub3JnL2RjL2RjbWl0eXBlL1N0aWxsSW1hZ2UiIC8+PC9jYzpXb3JrPjwvcmRmOlJERj48L21ldGFkYXRhPjxkZWZzCiAgIGlkPSJkZWZzMzEiPjxyYWRpYWxHcmFkaWVudAogICAgIGlkPSJTVkdJRF8xXyIKICAgICBjeD0iNzEuMDkxNzk3IgogICAgIGN5PSIxOC4wMzYyIgogICAgIHI9IjE0LjUxOTMiCiAgICAgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiCiAgICAgeGxpbms6aHJlZj0iI1NWR0lEXzJfIj4KCTxzdG9wCiAgIG9mZnNldD0iMCIKICAgc3R5bGU9InN0b3AtY29sb3I6I0ZGRjIwMCIKICAgaWQ9InN0b3AxMTQ5OSIgLz4KCTxzdG9wCiAgIG9mZnNldD0iMSIKICAgc3R5bGU9InN0b3AtY29sb3I6I0E5N0M1MCIKICAgaWQ9InN0b3AxMTUwMSIgLz4KPC9yYWRpYWxHcmFkaWVudD48bWFya2VyCiAgICAgc3R5bGU9Im92ZXJmbG93OnZpc2libGU7IgogICAgIGlkPSJtYXJrZXIxNTI2IgogICAgIHJlZlg9IjAuMCIKICAgICByZWZZPSIwLjAiCiAgICAgb3JpZW50PSJhdXRvIgogICAgIGlua3NjYXBlOnN0b2NraWQ9IkFycm93Mk1lbmQiCiAgICAgaW5rc2NhcGU6aXNzdG9jaz0idHJ1ZSI+PHBhdGgKICAgICAgIHRyYW5zZm9ybT0ic2NhbGUoMC42KSByb3RhdGUoMTgwKSB0cmFuc2xhdGUoMCwwKSIKICAgICAgIGQ9Ik0gOC43MTg1ODc4LDQuMDMzNzM1MiBMIC0yLjIwNzI4OTUsMC4wMTYwMTMyNTYgTCA4LjcxODU4ODQsLTQuMDAxNzA3OCBDIDYuOTczMDkwMCwtMS42Mjk2NDY5IDYuOTgzMTQ3NiwxLjYxNTc0NDEgOC43MTg1ODc4LDQuMDMzNzM1MiB6ICIKICAgICAgIHN0eWxlPSJmaWxsLXJ1bGU6ZXZlbm9kZDtzdHJva2Utd2lkdGg6MC42MjU7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZTojZmYwMDAwO3N0cm9rZS1vcGFjaXR5OjE7ZmlsbDojZmYwMDAwO2ZpbGwtb3BhY2l0eToxIgogICAgICAgaWQ9InBhdGgxNTI0IiAvPjwvbWFya2VyPjxtYXJrZXIKICAgICBzdHlsZT0ib3ZlcmZsb3c6dmlzaWJsZTsiCiAgICAgaWQ9IkFycm93MlNlbmQiCiAgICAgcmVmWD0iMC4wIgogICAgIHJlZlk9IjAuMCIKICAgICBvcmllbnQ9ImF1dG8iCiAgICAgaW5rc2NhcGU6c3RvY2tpZD0iQXJyb3cyU2VuZCIKICAgICBpbmtzY2FwZTppc3N0b2NrPSJ0cnVlIj48cGF0aAogICAgICAgdHJhbnNmb3JtPSJzY2FsZSgwLjMpIHJvdGF0ZSgxODApIHRyYW5zbGF0ZSgtMi4zLDApIgogICAgICAgZD0iTSA4LjcxODU4NzgsNC4wMzM3MzUyIEwgLTIuMjA3Mjg5NSwwLjAxNjAxMzI1NiBMIDguNzE4NTg4NCwtNC4wMDE3MDc4IEMgNi45NzMwOTAwLC0xLjYyOTY0NjkgNi45ODMxNDc2LDEuNjE1NzQ0MSA4LjcxODU4NzgsNC4wMzM3MzUyIHogIgogICAgICAgc3R5bGU9ImZpbGwtcnVsZTpldmVub2RkO3N0cm9rZS13aWR0aDowLjYyNTtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlOiNmZjAwMDA7c3Ryb2tlLW9wYWNpdHk6MTtmaWxsOiNmZjAwMDA7ZmlsbC1vcGFjaXR5OjEiCiAgICAgICBpZD0icGF0aDg5MyIgLz48L21hcmtlcj48bWFya2VyCiAgICAgc3R5bGU9Im92ZXJmbG93OnZpc2libGU7IgogICAgIGlkPSJtYXJrZXIxNDMwIgogICAgIHJlZlg9IjAuMCIKICAgICByZWZZPSIwLjAiCiAgICAgb3JpZW50PSJhdXRvIgogICAgIGlua3NjYXBlOnN0b2NraWQ9IkFycm93MVNlbmQiCiAgICAgaW5rc2NhcGU6aXNzdG9jaz0idHJ1ZSI+PHBhdGgKICAgICAgIHRyYW5zZm9ybT0ic2NhbGUoMC4yKSByb3RhdGUoMTgwKSB0cmFuc2xhdGUoNiwwKSIKICAgICAgIHN0eWxlPSJmaWxsLXJ1bGU6ZXZlbm9kZDtzdHJva2U6I2ZmMDAwMDtzdHJva2Utd2lkdGg6MXB0O3N0cm9rZS1vcGFjaXR5OjE7ZmlsbDojZmYwMDAwO2ZpbGwtb3BhY2l0eToxIgogICAgICAgZD0iTSAwLjAsMC4wIEwgNS4wLC01LjAgTCAtMTIuNSwwLjAgTCA1LjAsNS4wIEwgMC4wLDAuMCB6ICIKICAgICAgIGlkPSJwYXRoMTQyOCIgLz48L21hcmtlcj48bWFya2VyCiAgICAgc3R5bGU9Im92ZXJmbG93OnZpc2libGU7IgogICAgIGlkPSJBcnJvdzFTZW5kIgogICAgIHJlZlg9IjAuMCIKICAgICByZWZZPSIwLjAiCiAgICAgb3JpZW50PSJhdXRvIgogICAgIGlua3NjYXBlOnN0b2NraWQ9IkFycm93MVNlbmQiCiAgICAgaW5rc2NhcGU6aXNzdG9jaz0idHJ1ZSI+PHBhdGgKICAgICAgIHRyYW5zZm9ybT0ic2NhbGUoMC4yKSByb3RhdGUoMTgwKSB0cmFuc2xhdGUoNiwwKSIKICAgICAgIHN0eWxlPSJmaWxsLXJ1bGU6ZXZlbm9kZDtzdHJva2U6I2ZmMDAwMDtzdHJva2Utd2lkdGg6MXB0O3N0cm9rZS1vcGFjaXR5OjE7ZmlsbDojZmYwMDAwO2ZpbGwtb3BhY2l0eToxIgogICAgICAgZD0iTSAwLjAsMC4wIEwgNS4wLC01LjAgTCAtMTIuNSwwLjAgTCA1LjAsNS4wIEwgMC4wLDAuMCB6ICIKICAgICAgIGlkPSJwYXRoODc1IiAvPjwvbWFya2VyPjxtYXJrZXIKICAgICBzdHlsZT0ib3ZlcmZsb3c6dmlzaWJsZSIKICAgICBpZD0iVHJpYW5nbGVPdXRTIgogICAgIHJlZlg9IjAuMCIKICAgICByZWZZPSIwLjAiCiAgICAgb3JpZW50PSJhdXRvIgogICAgIGlua3NjYXBlOnN0b2NraWQ9IlRyaWFuZ2xlT3V0UyIKICAgICBpbmtzY2FwZTppc3N0b2NrPSJ0cnVlIj48cGF0aAogICAgICAgdHJhbnNmb3JtPSJzY2FsZSgwLjIpIgogICAgICAgc3R5bGU9ImZpbGwtcnVsZTpldmVub2RkO3N0cm9rZTojZmYwMDAwO3N0cm9rZS13aWR0aDoxcHQ7c3Ryb2tlLW9wYWNpdHk6MTtmaWxsOiNmZjAwMDA7ZmlsbC1vcGFjaXR5OjEiCiAgICAgICBkPSJNIDUuNzcsMC4wIEwgLTIuODgsNS4wIEwgLTIuODgsLTUuMCBMIDUuNzcsMC4wIHogIgogICAgICAgaWQ9InBhdGgxMDA4IiAvPjwvbWFya2VyPjxtYXJrZXIKICAgICBzdHlsZT0ib3ZlcmZsb3c6dmlzaWJsZTsiCiAgICAgaWQ9IkFycm93Mk1lbmQiCiAgICAgcmVmWD0iMC4wIgogICAgIHJlZlk9IjAuMCIKICAgICBvcmllbnQ9ImF1dG8iCiAgICAgaW5rc2NhcGU6c3RvY2tpZD0iQXJyb3cyTWVuZCIKICAgICBpbmtzY2FwZTppc3N0b2NrPSJ0cnVlIj48cGF0aAogICAgICAgdHJhbnNmb3JtPSJzY2FsZSgwLjYpIHJvdGF0ZSgxODApIHRyYW5zbGF0ZSgwLDApIgogICAgICAgZD0iTSA4LjcxODU4NzgsNC4wMzM3MzUyIEwgLTIuMjA3Mjg5NSwwLjAxNjAxMzI1NiBMIDguNzE4NTg4NCwtNC4wMDE3MDc4IEMgNi45NzMwOTAwLC0xLjYyOTY0NjkgNi45ODMxNDc2LDEuNjE1NzQ0MSA4LjcxODU4NzgsNC4wMzM3MzUyIHogIgogICAgICAgc3R5bGU9ImZpbGwtcnVsZTpldmVub2RkO3N0cm9rZS13aWR0aDowLjYyNTtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLW9wYWNpdHk6MTtmaWxsOiMwMDAwMDA7ZmlsbC1vcGFjaXR5OjEiCiAgICAgICBpZD0icGF0aDg4NyIgLz48L21hcmtlcj48L2RlZnM+PHNvZGlwb2RpOm5hbWVkdmlldwogICBwYWdlY29sb3I9IiNmZmZmZmYiCiAgIGJvcmRlcmNvbG9yPSIjNjY2NjY2IgogICBib3JkZXJvcGFjaXR5PSIxIgogICBvYmplY3R0b2xlcmFuY2U9IjEwIgogICBncmlkdG9sZXJhbmNlPSIxMCIKICAgZ3VpZGV0b2xlcmFuY2U9IjEwIgogICBpbmtzY2FwZTpwYWdlb3BhY2l0eT0iMCIKICAgaW5rc2NhcGU6cGFnZXNoYWRvdz0iMiIKICAgaW5rc2NhcGU6d2luZG93LXdpZHRoPSIxNjgwIgogICBpbmtzY2FwZTp3aW5kb3ctaGVpZ2h0PSI5MjUiCiAgIGlkPSJuYW1lZHZpZXcyOSIKICAgc2hvd2dyaWQ9ImZhbHNlIgogICBpbmtzY2FwZTp6b29tPSI0LjgzNjI0NTUiCiAgIGlua3NjYXBlOmN4PSIyMS40MDA4OTkiCiAgIGlua3NjYXBlOmN5PSI1Ny4xNzI0NDkiCiAgIGlua3NjYXBlOndpbmRvdy14PSIwIgogICBpbmtzY2FwZTp3aW5kb3cteT0iMjUiCiAgIGlua3NjYXBlOndpbmRvdy1tYXhpbWl6ZWQ9IjEiCiAgIGlua3NjYXBlOmN1cnJlbnQtbGF5ZXI9IkxheWVyXzEiCiAgIGlua3NjYXBlOnBhZ2VjaGVja2VyYm9hcmQ9IjAiIC8+CjxzdHlsZQogICB0eXBlPSJ0ZXh0L2NzcyIKICAgaWQ9InN0eWxlMiI+Cgkuc3Qwe2ZpbGw6dXJsKCNTVkdJRF8xXyk7c3Ryb2tlOiM5ODY4Mjg7c3Ryb2tlLXdpZHRoOjAuNTtzdHJva2UtbWl0ZXJsaW1pdDoxMDt9Cgkuc3Qxe2ZpbGw6dXJsKCNTVkdJRF8yXyk7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjAuNTtzdHJva2UtbWl0ZXJsaW1pdDoxMDt9Cgkuc3Qye2ZpbGw6bm9uZTtzdHJva2U6I0VEMjAyNDtzdHJva2Utd2lkdGg6ODtzdHJva2UtbWl0ZXJsaW1pdDoxMDt9Cgkuc3Qze2ZpbGw6bm9uZTtzdHJva2U6I0VEMjAyNDtzdHJva2Utd2lkdGg6ODtzdHJva2UtbWl0ZXJsaW1pdDoxMDtzdHJva2UtZGFzaGFycmF5OjguNjExNSw2LjQ1ODY7fQo8L3N0eWxlPgo8cmFkaWFsR3JhZGllbnQKICAgaWQ9IlNWR0lEXzFfLTEiCiAgIGN4PSI3MS4wOTE3OTciCiAgIGN5PSIxOC4wMzYyIgogICByPSIxNC41MTkzIgogICBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIKICAgeGxpbms6aHJlZj0iI1NWR0lEXzJfIj4KCTxzdG9wCiAgIG9mZnNldD0iMCIKICAgc3R5bGU9InN0b3AtY29sb3I6I2ZmZmJlNTtzdG9wLW9wYWNpdHk6MSIKICAgaWQ9InN0b3A0IiAvPgoJPHN0b3AKICAgb2Zmc2V0PSIxIgogICBzdHlsZT0ic3RvcC1jb2xvcjojZmYwMDI4O3N0b3Atb3BhY2l0eToxIgogICBpZD0ic3RvcDYiIC8+CjwvcmFkaWFsR3JhZGllbnQ+CjxwYXRoCiAgIGNsYXNzPSJzdDAiCiAgIGQ9Ik04MC42LDUuNWM1LjgsNC40LDYuMywxMy42LDEuMSwyMC41Yy01LjIsNi45LTE0LjIsOS0yMCw0LjZTNTUuMywxNyw2MC41LDEwLjFTNzQuNywxLjEsODAuNiw1LjV6IgogICBpZD0icGF0aDkiCiAgIHN0eWxlPSJmaWxsLW9wYWNpdHk6MTtmaWxsOnVybCgjU1ZHSURfMV8tMSk7c3Ryb2tlOiNjZDAwMDA7c3Ryb2tlLW9wYWNpdHk6MSIgLz4KPHJhZGlhbEdyYWRpZW50CiAgIGlkPSJTVkdJRF8yXyIKICAgY3g9IjQyLjY3NTEiCiAgIGN5PSI1OS4yODYyIgogICByPSIzMi42OTk1IgogICBncmFkaWVudFRyYW5zZm9ybT0ibWF0cml4KDEgMCAwIDEuMTUgMCAtOC44OTI5KSIKICAgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiPgoJPHN0b3AKICAgb2Zmc2V0PSIwIgogICBzdHlsZT0ic3RvcC1jb2xvcjojODU4NTg1IgogICBpZD0ic3RvcDExIiAvPgoJPHN0b3AKICAgb2Zmc2V0PSIxIgogICBzdHlsZT0ic3RvcC1jb2xvcjojMzgzODM4IgogICBpZD0ic3RvcDEzIiAvPgo8L3JhZGlhbEdyYWRpZW50Pgo8cGF0aAogICBjbGFzcz0ic3QxIgogICBkPSJNNTkuMSwyOC4yYzE0LjYsNy43LDE5LjIsMjcuOSwxMC4xLDQ1LjFTNDAuOSw5OC4xLDI2LjMsOTAuNFM3LjEsNjIuNSwxNi4xLDQ1LjNTNDQuNCwyMC40LDU5LjEsMjguMnoiCiAgIGlkPSJwYXRoMTYiIC8+Cgo8cGF0aAogICBpZD0icGF0aDE2OTUiCiAgIHN0eWxlPSJmaWxsOiNmZmU3MDA7ZmlsbC1vcGFjaXR5OjE7c3Ryb2tlOiM0NTQ1NDU7c3Ryb2tlLXdpZHRoOjE7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6NDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLW9wYWNpdHk6MSIKICAgZD0iTSA3Mi4xMzQ0NTMsMTYuNDExMzI3IDM3LjQyNDIwOSw0Ny4xNjAxNCA0OC4yOTY3NSw0OC43ODkyODMgMzQuMjY0MjQsNzIuNTU5MTQ4IDY4LjI3MzgwMiw0Mi45MTQ1NzYgNTcuNTA3NzM5LDQxLjIwMjU3IFoiIC8+PC9zdmc+Cg=="
LABEL oc.keyword="Cell-ACDC"
LABEL oc.cat="development"
LABEL oc.template="abcdesktopio/oc.template.ubuntu.22.04"
LABEL oc.name="Cell-ACDC"
LABEL oc.desktopfile="org.kde.konsole.desktop"
LABEL oc.launch="Cell-ACDC.Cell-ACDC"
LABEL oc.displayname="Cell-ACDC"
LABEL oc.path="/opt/conda/envs/acdc/bin/acdc"
LABEL oc.type=app
LABEL oc.rules="{\"homedir\":{\"default\":true}}"
LABEL oc.showinview=dock
LABEL oc.acl="{\"permit\":[\"all\"]}"

RUN  if [ -d /usr/share/icons ];   then cd /usr/share/icons;    /composer/safelinks.sh; fi \
     &&  if [ -d /usr/share/pixmaps ]; then cd /usr/share/pixmaps;  /composer/safelinks.sh; fi 

ENV APPNAME "cellacdc"
ENV APPBIN "/opt/conda/envs/acdc/bin/acdc"
ENV APP "/opt/conda/envs/acdc/bin/acdc"

RUN mkdir -p /run/user \
    && chmod 777 /run/user

USER root
RUN mkdir -p /etc/localaccount \
    && for f in passwd shadow group gshadow ; do if [ -f /etc/$f ] ; then  cp /etc/$f /etc/localaccount; rm -f /etc/$f; ln -s /etc/localaccount/$f /etc/$f; fi; done

CMD ["sh", "-c","mkdir -p ~/tmp && /composer/appli-docker-entrypoint.sh " ]


