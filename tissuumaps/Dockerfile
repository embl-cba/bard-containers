FROM registry.git.embl.de/grp-cbbcs/abcdesktop-apps/base-image:ubuntu22-cuda-11-8
ARG DEBIAN_FRONTEND="noninteractive"

ENV LANG en_US.UTF-8 \
    LC_ALL en_US.UTF-8 \
    LANGUAGE en_US:en  \
    NUMBA_CACHE_DIR=/tmp

ENV VGL_DISPLAY egl0
ENV VGL_COMPRESS proxy

ENV CONDA_BIN_PATH="/opt/conda/bin"
ENV PATH $CONDA_BIN_PATH:$PATH
ENV LD_PRELOAD="/usr/lib/x86_64-linux-gnu/libstdc++.so.6"
ENV LD_LIBRARY_PATH /usr/local/cuda/lib64:/usr/local/nvidia/lib:/usr/local/nvidia/lib64:/usr/lib/x86_64-linux-gnu
ENV NVIDIA_DRIVER_CAPABILITIES all

ENV QT_DEBUG_PLUGINS=1
ENV QT_PLUGIN_PATH="/opt/conda/envs/tissuumaps_env/lib/python3.9/site-packages/PyQt6/Qt6/plugins/platforms"




RUN apt-get update -y && \
    apt-get install -y -q --no-install-recommends \
        software-properties-common \
        build-essential \
        curl \
        wget \
        libglvnd-dev \
        libgl1-mesa-dev \
        libegl1-mesa-dev \
        libgles2-mesa-dev \
        libglu1-mesa-dev \
        libglvnd0 \
        libgl1 \
        libglx0 \
        libegl1 \
        libgles2 \
        libglu1 \
        mesa-utils \
        libxcb1 \
        libxext6 \
        libxv1 \
        libxtst6 \
        dbus-x11 \
        libxrandr-dev \
        xvfb \
        gcc \
        konsole \
        python3-dev \
        python3-pip \
        python3-wheel \
        libblas-dev \
        liblapack-dev \
        libxcb-cursor0 \
        libgl1-mesa-glx \
        libxcb-xinerama0 \
        libatlas-base-dev \
        gfortran \
        apt-utils \
        bzip2 \
        ca-certificates \
        libnss3 \
        libxcomposite-dev \
        libxdamage-dev \
        libxrandr-dev \
        libxtst-dev \
        locales \
        libarchive-dev \
        cmake \
        libxcb-cursor-dev \
        libvips-dev \
        libglib2.0-dev \
        libexpat1-dev \
        freeglut3-dev \
        mesa-common-dev \
        libglew-dev \
        libglfw3-dev \
        libglm-dev \
        libao-dev \
        libmpg123-dev \
        libegl1-mesa \
        libxkbcommon-dev \
        libxkbcommon-x11-dev \
        libxkbfile-dev \
        libxcb-shape0-dev \
        libxcb-keysyms1-dev \
        libxcb-icccm4-dev \
        unzip &&  apt-get clean && \
        rm -rf /var/lib/apt/lists/* && \
        sed -i '/en_US.UTF-8/s/^# //g' /etc/locale.gen && \
        locale-gen


WORKDIR /tmp
RUN wget https://github.com/conda-forge/miniforge/releases/latest/download/Miniforge3-Linux-x86_64.sh \
    && bash Miniforge3-Linux-x86_64.sh -b -p /opt/conda \
    && rm -f Miniforge3-Linux-x86_64.sh 

WORKDIR /tmp
ARG VIRTUALGL_VERSION=3.1
ARG VIRTUALGL_URL="https://sourceforge.net/projects/virtualgl/files"
RUN curl -fsSL -O "${VIRTUALGL_URL}/virtualgl_${VIRTUALGL_VERSION}_amd64.deb" && \
    apt-get update && apt-get install -y --no-install-recommends ./virtualgl_${VIRTUALGL_VERSION}_amd64.deb && \
    rm -f "virtualgl_${VIRTUALGL_VERSION}_amd64.deb" && \
    rm -rf /var/lib/apt/lists/* && \
    chmod u+s /usr/lib/libvglfaker.so && \
    chmod u+s /usr/lib/libdlfaker.so 
    
LABEL oc.icon="tissuumaps.svg"
LABEL oc.icondata="PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgoKPHN2ZwogICB2ZXJzaW9uPSIxLjEiCiAgIGlkPSJzdmc0OCIKICAgd2lkdGg9IjIxNiIKICAgaGVpZ2h0PSIyMzMiCiAgIHZpZXdCb3g9IjAgMCAyMTYgMjMzIgogICB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIKICAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8ZGVmcwogICAgIGlkPSJkZWZzNTIiIC8+CiAgPGcKICAgICBpZD0iZzU0Ij4KICAgIDxpbWFnZQogICAgICAgd2lkdGg9IjIxNiIKICAgICAgIGhlaWdodD0iMjMzIgogICAgICAgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSIKICAgICAgIHhsaW5rOmhyZWY9ImRhdGE6aW1hZ2UvcG5nO2Jhc2U2NCxpVkJPUncwS0dnb0FBQUFOU1VoRVVnQUFBTmdBQUFEcENBTUFBQUJ4MkFuWEFBQUJkMUJNVkVYLy8vL1EwTkEvUHo5L1ByN0pZWXlpCkNBaWhBQUNlQUFDY0FBRFQwOU04UER4N1BNRExZb3JWMWRYT3pzNHpNelBNYUpFNE9EaW1BQUF3TUREdzhQRDU3L1BIVjRaNU84SDgKOXZqTlk0bklYSW5LWTQ5SlNVbFRVMU00UVVIeTRPREF3TURCVW5IbTV1YnIwZEdFUUx2MzYrdllwNmV2cjY5TFMwdkRYcERTbXBxMQpTRWl3UUVDNlhsNkhRcm1zVTZHMlVsTGd1Ym0vYTJ0Y1hGeUJnWUdnb0tCMks3cVhTYSttSGg2dlZKK3JNRERNaW9ybXhjVzlXNVJ6CmMzT1ZsWldUWDhpc2lOVDE4UHFRUnJUSGZYM1dvYUhOam81c0xDeG5aMmV0TXpPZWNjMkxVY1RTd09mWWtxNjJXSnJreWNsck9EaEcKT3p1QklDQ1hFaEtlVGF1Y0V6UEpwcVlrSkNUajJQQytvOXlwaE5MRXJPRGF5dXUwbE5qcjR2U2hkODdyeWRiZnFMM252czdTZjZDNApSbGV2TUQrMlFGRjFQajVTTnpkWE5EU0pFUkY2SmlhVUZCVEVYbmlRS0hlYkZqMmZFU2VXSldpVU1vZWVJbEdOTlppaVQwK1FXbHB6CldGaDdSVVdiT1RtVEppYUZRRUJ3UzB2cUNrTmlBQUFaQWtsRVFWUjRuTldkaVhzYVI3TEFFWUtlNFRZZ1MyQWRZQ0ZBQjBpQWtEMUcKbHhNZGxtSkhzaDJ2bld3MjE2N3R5SEh5TnUvdDI1ZU5rei8rOVRuVE05TXowMENQaE92TEYrc1dQMVYxZFZWMWRVMGtNaUh5NlpkUAp2dnJtczRjUEg2OU1UMjgrZnZqWlg3LzYrc20zbjk3MHF4cFB2bjN5eWVQcGUvZnV6YzJscHBta1VuUG9JOU1QdjNueWtkTDk3WlBICkNNQkxFTi9Ecjc2ODZWYzVyUHp0cjNNK1VCemM1amZmM3ZScmxaZFB2NXFXb0tJeWQrL3gxNldiZnNWUzh1VjM5KzdKVWhHOTNVdDkKTS9uTDdkdlA1SlZseWIyNUNVY3JmWEl2Rll3aFJFdDlkZE12M2tlZWpLSXRFMjFsVWwza3A1OE50N2JjYUovY05JSlFuc3lOb1M1Swo5bmdDZmY4M1k2b0xTK3JlazV2bWNNcDNLcmlnM0pzc0gxSjZxSWhyd2hiYXA0L0hYbDRjMlhjM2pXUEpRNFZjazZRenRWeVRzODQrClViYStURElGdnRFbnNDNEZ5dTNiOEg5ZksrZUNaTi9pbno4eTFQZWYzL0tYZVNneEtIZGNNc3RrUHdRdUtMUHdkOXk2OWZuM0kyRGQKL21GMjlrNXNYQ2x2amhqMStrdnFSUm4vUVdmdi9IQjdTSzRmRkZERll1bXRVTGhnL3JtZkpyL2h6dXpudzVqazdWdXpDckNnaElNRgpWWFpVWnIvaXpueEZtdXY3T3lyVUZhTENPSlZCbWYxZWtxdWlTRjJ4OUVwWVhMektwTWx1SytONm9IaHJ0cEd0Y2I5cFZzb2FiNm14ClErZ1NqMEt6Uk9RWTAvenZrdUQ2UVpYQ1ltc2hjazFQcjNDMkdMdnplU0JYU1JsWCtrR29ZS2w5L3BmTkJ1NW5QNmd5eEZqNWZyaGcKVzd3dEJxdHNYaFVYakRyQzVKcE8zZWR0TVRZYnNFOS9yOHdTWTJ1aGNrMVBiOXJCL241ZGxoamJEOVVTb2Nwc1lIZis0US8yRDJWZwo2WXVRd2VZY3Y5RGZGbS9GWXZPbVREalltdTMzM2ZIemk2WGJ0OHEvM0RXbFhDNm4wN0VSR1NjRHJOUmQ3N1U3QTZCclVBQVY4cmJ4CjY1dlhrSEZvdk1rQXErdVlSNHU3aFVJQ0EvS1ZoNEJMWDRRWUtXSXcrKy96MEppUXlRMFlmM08zZkVzUzducTlvdGNhR3dDQm10d1MKaC9acHZFV2FDd2E3M24zTUM2eGpBd09EWHE4TnBkUHBiR0Jwd2Y4TXc0REFyVTVjMDNYamRUQmJpTmtZRWtmazRRWFdzNWtpNkFtLwpLQktKNjEyNElHdU5ObFJjRU51MXhvcWVZT3MyTU0wTHpOQkpTbmVxSVdzZDNFMzdzSVZZR01CZysxSmdYVHZZc1FkWVFTUC90Z0ZkCmlXL3VlcU9GbTQ5TjI3bTh3R3E2RkpoMlR2NDlaMHNTcVMzbWdaWU9NN3gzTGpFdnNMb05ETFJybDVjMUpQVFR0R2hkMTF0NytFT2MKZnFHcmZIMUxpQmFxTGFZdTVEUVdjYmg3RFl0T0xhK3JFNEVyQy80LzNyTzdHcmkxdjA2TDBPWkRCTnQwY0htQ09UWXk5cElwR0FNQgpSZ0ZIWGM0dkZLT2xYNFJYVjN3Z0M5WVdnWUdDQTB5dmxTcmQ5WTdvUytNQ3RQQlV0dUw2SzNxQkhRdmpSQmRZaWZzcm9FaUUxMjc4CjdxM3JXbVZ1aFhtQ05jUUJzQjJNZ1NLbkNQUjR5NENyMElJRDJ1QVhoOUpDY293cFJ6amxCM2FwaThEaURyQTJmcmNPVmFWMThGWmQKV3gvb0hCcDRhN2ZIZERpUnNITno5Z09yK0lFeGRXcTc1R3MxUGphNTdQQmFpOSsxa1pYRDhCK3BMYmZDdkROb0laaEJQbmZDd0xwVQpnUUR3RllaYXk5S2FwZzNLUEZvSWRXNTY3Q2NMRmhlNFJSY1lpUlRYTlczZC9zMWR3QysxdDdZd1MzV1FuenB5MjZFZldNY0hqSWJJCkdxampkM3NhSlR3OWJwQ1BSRXI4M3dVWW5OTFNpdk95MUtZSXl3ZHNWK0FXd1lCODdsU3pjUTZBaGkyeGl6YnJIa1lyMmRNZThKb2oKMjFmS3RUSXZWSmczMkxvRVdJZThDNENHYWVweDZFVTA3WVF6Vm5PcHZiRkNZMGltYkoybFZ0YkVYTjVnZXlLd2M1czJ0VlA4SG5LSwp4SXRFZXRCckFMMVZweEVadDJYejdqRzl0cUtJTExYcG9TOGZzSW9FV0FPL1Y0T3hjSng2eGNvR1FvdmpMNEFiZEF0YUtXRG15SkhOCnEvR05jL2RqWGx6ZVlIVkJvUXEwYkdBNnlXTFFyZ1phMUd0Z2g0aS9GY1F2MFkvWk5YOE9lTXN0TkJYN21YRC9DZ1FUK1hzSEdIV0sKeDBncEJBTkpxYVVSMjZPbzlUYmJFZ0czME1vWDR5NjAxT2ErRDVjUDJMa0FiSU1IWTA1eG85VkJPdE43ZGU0NzJRNkFWY3IyYTk3dgpwK2Z2ajFOQlRVRjFlWnFoUDVnZ2NYR0FVYWNJUGNleGpsbE9xWTVnZ3NiZXhsSmpUc1FXWVpVdk5rZEZTNldPMXZ6VTVRdDJLbGhqCkhSNk1Wa0pLT2xJS1dra3dmRExUR0ZxK29qMXBGVVBnUW1McDlJUFIzR1BxNkNJQXl3OU1rTGd3TU1KTW5lSWxqbi9yeHhwY2FucUQKZ1pOTXJhWlIrZ3JUbWNhVFFaKzJOVFJhS3JWNTRXK0ZBV0I3S0k0bzJNWG9ZQ0c3bExhT1gzempoQnJncnFFYmRWTmorSzJ1RG4wKwpmc3NxZTluSVl1bnlnODI1SWRoU3FmdjdFbGgrWVBWT2I3Mzc0OU4zVjFkWHo2QmNYYjE3K3VqUjg1OTBIUUtTUHovVVVXZTkyOU5QCm5kOEsxeElOaTlzYWM0OVdwZEpPQnRIMlg2eklzY0dsdFRVdmhSVnc4QmVKTEN4Rk9WbENFbjMyN3RIekwrSVlEaDJhUVFoano2NXIKK0RGQTl3TG8rMGtnVmpQQk5PMnVJN0V1eHk1ZWJLWlN2bkR3czVzdjl0TnlWQkpneWFoQUlONnpkKysvWUpxRHJuNmp4bjJUVVRkUQpTbzNmTHFFM2V5VExwbCs3ZnFrN3lhQWZLYTg5d0hCdVBQekJ6UmNQMWlSMU5RWVlwWHYyNkFOamd3R2ltYkdjVitENk5KMG1Jb0krCnBXVTZqeHJhMkZ4a0NLNWNuci9ZZW5HME9UM0h5ZlRtL1JkYis3SHlVRlJqZ1dHMjZOUG44UUpCMC9UV2FhUGJPTVlCTVNweTZXU1oKMWREaGFKdkdLbm9QTzV5Mnl4cE56VUc4Y214dEg4bmEydHA4R1I5OER3azFOaGlHaXo3Nm1ha05sNHRKUElLQ0VlcjhUOUJSRE4zRgpHbFNyVGc4aUloeUJSaVVZMHR2Vjg0SVZwbEIvQ01rMG5jU1ByS3FzRGN3d3E2YUJjdEJKNFhpaUFBeXhQWHR2b2Vra09ldkFQWXlFCllHUS9oMlpvL2R3SzNBWEcwOGoxZ0NHTHRMU21FKy9mTUFDclltRTc3Vm8vOWdSbGJVYW9aS3JBa05ZK0ZLaEg1eG1veGpRellZTXIKakNReTRJMnpCRDZaWUJEdDNSZlVRK29uL0ErQmFiVE9IUjFlR3F5US9EYkVaYVlTREtJOW92NlBYMC9yR3FEK0Vjc3hWMDE5SFI2WgpXakM0MUtnOWFnYUxSVkFnYk1VbE5MOW1aTTVUaTJzRFd4MFNES0k5SlRVRm9MVnJjRE11SVgxWm9lUWVYMGxCaFo3QXZHcGl3S0RTCmZtSXJMZDdhZ0NEMDZBS2JJWGRlQWJjMUNIMGVsZ09SQTBzbTh6a3N5ZWhDRkwrUlQvcEVrWStZZThSZFNYSDJ3K3JudkxyUU11eHAKV2xnT0pCZ01NaFVYenZvN3pXcDJLb01sVzIzdUhCNHNGaUdkQjlsVjNCV0prR3pHNGlKN25BSENXbVpCemlPWDMrNDNzd21JazBoTQpNVWtrNEFjUzJXWi9HK2xRS05RYzQyYjFNWEtxODJhNFFiYTFDZ3lRdzFsbUFXQm5PMW1JTUNVV1NGYzkzTTduaFVwN3pzaElrUUNtCktyd1pta2szWEdhRFVGVG1DellERmVVQnhRU3k5YU1pdFprTGpZTHh4Z2s0OXc5OVl5aTdtUS9ZOGxRMmdJcnFMYkd6S2tCYmVrcDMKTk9Mc3JXS08zcmFPUDNGZERvU3h6RHpCbHJOU1dFUnRpY09Gbk1pRllMQmRtOGFBeGtVaHBFWU1qQkI4dmdmWXNqd1ZRY3YyM1M2UwprTkZLT0ZsalFHdHhkN3Q2ZWh3ZllBaUN4alFUcFdBemlTRzVFRnAxMjZVMFFrWlYxTk5SVFlzN3JLNFlxQmRyQTlkSGZ1SHJ3K1YwCmJHMy80c0dEcmEydEJ4Zjc4K215cXRMQXNPb2lrc2djRnAxS1czcUd0VVIrN0hvOGZtemxMamduMDFDdEFHWTFHczA2MDJWVXJEcGEKbVp1YlMxR1ptMXM1R3JaQzVRR1dHWWtMS2EwWmRaTnA0blpIbEpPeDBzNEFoaWUvenNkUUJlNW9XbENBSStXM0lkbmNZQ056SVhOMAp4WmJZR3ZXdTg1ZlVvQm1hZFZiVUJRUmVyMjBoS3I4cThNVXdKdWtDODlxTnBTU1JkZVU1Uys5UVdkaHhHeFJ1eTBEZk5iMCs2bmNFCmdTWDgxTnptMXVpVjRIR3dFRm5WYlkzdkNwQ01yeFRYVVoxbndIMEU5Yk9DdjBpVTcrZFdncytQeEdCajZZdVF1Y0orRklQd09mUUoKVkpldGxhZUdEMDhML3lWek1ERjMzN05Qd0E4c0tJQ1NrRXpUN2ZWUjNLaHQ3Q0hUcTZ3Yk1QUHNjS1paNnRHb0gwajEvS1ZXQksxdQpRV0NqK1hrbjJhR2I3R2ZjMEFnMk9nTlU3K1pqajBqWDZpcjRpd3dZNm11V01VY2ViRVlGRnlRN2M4WDd6Nnk4MDh4WXlPcHFjOG1NCm5ERkNjNVFoNHk4TUs4R0NrbldCTFYyWjZablc1dFMxenVkb2tQeElUbWR6emw1MGZ6QWxob2hFWkl4bXRXQmdZVjBPSE1mY1VwNFIKVzJQd091UEFWSEZCY2RlQWxqN1E0MTNMeXgvYjFJV1htcXd4VHE4RUpqb1dtREtGQ1ZVV2paS1gzekhWRmVmVkJmUVc3a29yU0haRAp1MjU4K0lBcHcwTGlMclNpZmRwc3RvVSszcVl1SEF5alZrQnBZeFEwcEh1QUtWUVlWRm5mWFFoWmVnL0pXRi9Md0s0dUVneHZnQ0dNCmNWcFdZd3IyWmtzUzFhTGJGcU5mbUFXUXRxM09QYUQ5WlJYVXFpUzNUYnN2d25tQ3FWUVlWSm1BS3dwOVBxbkYxVzBWSzc1UUROLy8KcDZ6L2tOT1lvczNaQkRzUUY2NUkwRkhoS2pzdFBoZ2V4ak9tL0ZjWkExdFd5Z1g5b3FqYUNFTXJzajBYek9ZSVBycTZKSzFrc3NZbwpia3QzZ2lsZFluQ1J1VU5oSk05b1czUlg1NTBHZFpUc3hFTFdHRk5yTndGV0ZZSXR2UWRrUmZWMFRkTTdmSkxXTlV5SFV2Z2Z1YzRxClgvZkJ3TVpPeEJ6aWpoZVJGSGZhMUM5MmU4YzhWb2tQaG1VVG1DTy9UWnFCS2VhYW1oS0I1ZnFaTE9DRFlDWU42T2lCZFJnanUwM0wKbUtKcXJvUUFMTG1kbWNxOGRGZDJLdWlTajJaVU9wWXhTbmxHKzJDamF3SVRtV0t1Q2cwKzA5RnJkaTdzTkxSMkNYZktNVElaWTNUZApwTDJPTlZaMWd4VjNzSWZLMmlzN0pJTW01MG9WMHhyQnJ6SmdmanZaOWJuNy9BSDVIWm1YbWxYWnFYUjBYRFdnNXJsbjdkei9IV3lNClVtQ0tOK2pFamhNc0dXV3hUYVlOdFBOR3ZWU3FkOG5sUUU2RjFoMm93djhHa2ttQnFRNnBYT0U5TlVRa1dkUnlxMnVBM2xUbHVwRzYKbkdjMEFtL1FTWUdWRklNdE9tSkY1QkhOVDc3a2czdXVpYWQwMmRndzl6UHdyNkRyQmxKZ2lyMkhLMjBwVnJsZmtMRnVZUURkY1F1eQpzc0dvQXdNUU9UQzFpYVl6Qm1hZWc0bDFjNEpyQUtlQm81bXNGWTVVZ0NtMXhZVFRFbk5WbTBVa3FESENYZG5FT2ptUHQ4bGlNNmwvCjlWOW1VdnVZVW9lZmFEb3NNZWxRR0RWRzJvR0twRFpBSmVJQmRTSG1Ndk52eGZjcndsbGdDdjFpNXN5aHNHTFR1WVNoWjR3RDYwRHcKaFBnTW1tQ2JOeUFEUWl1L3ZJV3JLeXBUbVd0MzVsMGkrNXFYMXMxT3VLeDB1dUxJTXJObWJ2anVab0lKQTBJd1pXVVA5d3JiY2YvUgpvREVDZW5tdVRuc1l6YjVHQ3d6RXZZTkcvOW9pRDZiSU1ickxwVVhoMXhVQWFZeGoxK1pNcnR1YVZBYmpYL1N3VFRGVllvd3V6K0YyCkhlVHJrREZ1NEE1VTZpRlpBRkxmN1hXMFlBY2lWeG9nb29MTGZReWQyeEh1L3BrZXpNS09kMm5jcTIzWUpqM1d6VWtwd011QitDYlEKRGpBRm5qSGhQaDBUV3lMMGpPaW1FbjM5dXF0bHdteVg4NGhBQWlxbWpvRzZZNU5sRGx6NVNuTFJ3OFFUWnN6SUgxRlh1dlJla3prVQpRT3dhL1MzUk5TbDRURElCVnpUZjkxcTd5QmlKbXpmemxub0gxYS9JUHNDdVpvR0M0S0s3ZnlsSE1BSjVaZ3lzeE5TWm9PcVdjKzNPCjFqZmc2QWtNSEhrTG5jMXphU3BVNFBTRFRqWGRzNTFMSTNTSUVjbFV0NFcxcWFvMzJFdk1ZWExSOWxxNlVkZXRhNTN1NUd3bDRJQk0KTkxSNnhLWWpRU3NWRVo4ZmwwSE96K3hmWjVmM2FTcGpnYm5KZ2c1YnhOTzRSekhIUktMdmFuNGp2bVBCYjN2TW9JVkVYSWQ1aVlLZAp2L0FES3B4a0svNVlubVBHaDFWYUl0TmNGZForZzhBU1ZSUjNvT0MzRW1mWEhabUh0TTFLQVFiL0JKRkFoWG5PVDU4WkJpMlJxWjU1CjlhbEhrNnUrQVUwR3ZYd0E2cXpjWVhuSUVzQlRKNnl3a2ZPTmdRcnpHUXd2M1dZS3NRNDhzWHkyTVVhR1VqUEFDdHphdWVsSlVHRlkKNjFrVDg0QzFuMGswZXZoTnZJZGFTd1NWUWxBUDkxblJ3d3Fsd0tZU0tKaG55OHVxN1BUSTlkVzZkUXl2c2ZRc2FBOExBb1BXY0ZqMQp2aytBcVpyaXJudDVVNFEvNVpLMVUzRVhEYWkrMEZ1VmxobnNGLzRsRTNSSWdFVldjOXVIeld6R1RZY3VnV1NiL2RXY243SWtuQWVTCnpEckx4OHpNczQ1T3k5ajRFTlMzeWN6eFYraEM1Z0k5UnpEWVlqS1pMeWEzK3p0TmFKVVpSSlBCMTF5eXpaMytkclRvZFd0bk9EQVkKV3VIcnFWWmxoMHpKQUJ2c05uekZQQlVFMEJ3bERGRUNETCsyZkM1WFRLNHVycTV1SDV4dGJ5OHVSb3M1ejZ0SWJnbDJRaG0weklDWgprSmtlVXRQYnRESEV1aWdJL2prcmM3RkNDb3orNlMyUlJjTGlFMUtaaG8wTGplYXNJWHhRb2Vtb0JBNVlQck5oa1lFM3doR3BJNE9OCktqNUJzRVdHeCtCaFo0RXZFMnRhYjYrMmg3cFIyUVpRNHFhcUF2RDJUdENJN0dzQTgwNWJlR1BFdVJrTUV2RzFRSmE0NENOM09ocWsKZ25jMHpkU2F6NmpsYXdJTDlQZUVETmNDOUJNY2EzRFhWWTkxUUhzY2QzR0lvcHZyRDAvLzlxUzdCakQ3Z1lRM0dhN1o0NWR0dTFwUgpNelNkRGFlQkcwRHRHSmpCbDJhOGZYMjNUSjdCNXdTOERqQXBXNlNCUGdreDZ2eHJLTFhKNVpnOWpXaXl0RzZlVmVQSFFzU05BZVQ3CnBaeW1oUFA0c1JmWEFTYXhreEdoTDVoNXgvcnVMbkgyRlFwbVR1UWt6N3F3ZkFsK0drVGNRSVN2Nzk0bHovZW9WZndlMXFVRVRGZ0oKRmtqaWt2UllzVFpVUTdQTktHaVlsN1NNOWttM3NWdXdkMG96UUR5Z0NCMlo2cm9QbVJxdzVLTGNzU0tNR25IRVFhWWQ0b20rM0hDVApEVHA0azJrdzBoWE5XZVZFdjNUeEtBYVRWUmwwK2pnZUpqWDlPdGFJeGdiYTdtbXU2MXBjWXdoN3lBVXZtcXRWUmptWVRGaEZ5RTR3CkRFbGVHbmdwc1QrN0FkeW1SUStjOEhRc0F3cXdqWmEyM2NnSUNTeC9KdWsvU0tSUC85YVYwOTQ2YzVBOWpmbVV5RjRMdEtneXlGZUQKOVFwUmE2bFNhMnhZVXpWY0k4NUMwRmp1Y0NneSs2U1RDTzV3WkpiVmdGczJPNU92QTZ2MkUrRllDWmpYb3pCVWdrV0x6ZUhJMmphNwpRMWYzNCt4TnJDVjY4Yk1GbkN2UG1qSW9iTFJURGhiTkQwZW1hYTEyejJ6VmhCRXdxejdTeHlIUUJkY3puUXViNWNoTno5dUllSXBDCnNPUXdaS1RRYlJvWkhreEdNek5XSFdFRFZJbTk3WFVNcU5QT2JzMHFqTnZ1MFlRSVp1czZDaUI3U2J5ZHRhcXNQejlWQ0J1OTM2T1cKQ0JNY0RYY3lnWmExQmNSTEFxUVF3S0xGZm1EVmk1TFJHSVFVclNxNlp0M01aVE9LcVRJM0tOZ3hmcVFZR3J6UHQrRFdoVkRxd2FLNQo3YXFjMGhKWnN2ZWlMQk52dzB4RGJMUXFqWk52QXhaL2xXcmRrMTRMMk1Jcy9kckFvc2xjUHl1RGxzaGtXM1R2N1pKMGh1MUpaR1lvCmM0Vm9GK0JmZldtdnc5M0NjUGF5aGdnR25XTWVvdmtiWkNLVGFSNFVWLzlkSUdUQS9zZEhtYWZPL0YwSHVKdzZOeEhGSjZaU0Q0YlEKRHBvSm43RXVVODMrQWlwWEx2MmZGZVN5VjQveXNiMTJtM1hNNGZtaFdzY2VhbG1QeC9HSnFjSUFnMmk1eFQ0cXc5cGNDUzVhVGxWMwpEaFpZdVhMcE43T0FReVBHVXNIdTU4NnB1WFpPTHV2bVo3aHBxWTZXd2REQmNLV1NsV0ZSSFJZS0dwM1VQMXUxalU1YVd2MjlZSnVPCjNiQjNONXFOdGlqN0FxMDJ0VHd6eVBkOFdGVjRZQlF1Vjh4RkY3Y1hGeGVTeFdKUk5PeHE2VC9ZT3pLYk12aHBhMncxc1hNYVNFZHMKMHJSZ241aHFCTEJrTXArbjQ3bHkrWHh3ZGRXL0FMdTA4SHNCc09heFM0MnY3eDlUcmtaYjA4bERxZWlYbVJwajgvbkhCa002aUM2ZQpIZlFQZDVyTjVzN096bUgvWUhzMVAwUTFYSVQycDhINi8vQkpHcnJiWHlyVkc2eWNyeU1uZjNMYzYvVk9hWVdFTzVOWEFaYk01UmY2Ck85VXNQYlpJSk9nUnhsUzEyZDlPamdHM0ZQMkpkc25SNWo5ZEk0T1hQWFpoNjdGTzFuUzJrY0dTdWVJWlBrc1RlWEY2NGlSMU5pTkcKMjg0aUl4TTl2OE1NamszcGN2dVlkMHdsQjVZdmJ1OU0rWjBRa3FsamtHMUV0R1R4M1hwRitJd2NjKzRWbGZveC80Z2d6Yk5PSlFPVwpUL2FyZ1JQSHBzajU1NWw0b0pvRVd2N2R2d3NGRVJpSXQ0NjdlN1ZLcmJiWE9PbllIL0kyRGxnK2VSZ1VJdkZzdnVmdy9taEx6OTRiCkJZSFM4T09CeWFQNU5NY1RQalRQQWx3UVdGNHlxT1hSemtZMXlPalMwbE56K3JlVWVBZUxBV0RGcytHd0NKcG5yNHNNMnNLUEgrTFMKY040eGxTOVlNaW1iRWp2UXB2ckNxNm15Yk5FLzMvOGNMOGpRZVJmZy9NRHlzbG1qV3pJN1krM1phQ1Q5MVIrL0craXN2ZUNzLy9JQwpQSU5GSDdEaWdXU2VMeVJ6ajNrYUhtNHBldlh1NlIvUFA1ekg4UU12QklEV2xBMTVzS0xjb1plWEpMS2pMelFISHBTRjM1NCsvZVAzCkR6OGJSdHg4c0FkMmxKNHhsU2VZZEdYWG0yeFJDWm1ORVA3NzdPcTNQMy84OGNmLy9MbFhxMVdHcjFLTnpZWEp3c21Ka2tuRVdKengKaFBJQnk0MW5oNHhzN0hYbUk4WGxFY0R5N2tzNG8waEdQSkRnNXNDU3NxZGRnV1Npb1VHS0pEZUNLY3FlVDBxUU9TK2FxWlBrOEdCSgoyVU84WUVrSUxyZ3I0bHJ3OW9oSXRnVmdFazFmMGlJYWg2UUdiTkdYS3lKWUJNNExzdU5KTmlSYnpQZjl3VEx1TVV4eURVU3lFcGJLCmlsVi9NUGV6RndUM0xjY1I4UVFyQldEK3ZpTVNjUTFEeUk4ZmM5akVkWGxmaWVRUEFyZ2lNNjhjMzZMU2RXQ3dVR3p4VlNZSXpPaysKcEJ1K1pNVmowTk40RXF3d0tQYUFUcTFQeEJMQ0lndGNZVWd5dHRxTDZpVUdiWEhZWjhNRXk2dXFCRmNra3VYSjFJVlRKcGdvQ0JpUAphMGVLS3hLcGNtUWVWMy9IQVZNZEwwcHpSU0xMMXZNSFFnQVREZlliWGZLQlc3Tk4rcS95SHdWWS90V1pmeDdtVmxxL2lFOUxKdGdVCmsvbmlxNFBnL2NzbE04MkR4Vnp4VlFoZThWVlJRbkpCa2wvc04yVzh2Qmh1V2VaWVpUakp6aWlTVWFHb0tKN3pCRFUyNWd0U0pvcTUKcG9aYzdPR0o0bUZxMlhGTlNKa29IcVkyZGRNOGxpakZ5azZNSlNxZU9aYjFMeVpkcnlqa21oeWZpRVNoeXJJM3pXSVhaWnYwSkswdwpKTW9jWStLbVNaeWl5QmdueW5NUUdlUEpVQnpYeE96Tm5DZ2dtN1FGUm1Wc3NnbmxHcHRzWXJuR0pKdkk5Y1ZrRE4rWW1HUXVOT1pwCk5MVHNSQVZTUWhuRkhMTlRrNjB1SWtPTmVTSmNrK3MxN0RMYzAwU3ptWTlCWFZTa3RaYk5MazllRU9VckpZa25FV2V6bVkvRkNHMHkKczV6d2VSNHhvdnJJbE1YSnpISUdJVGlSc2xPSjVZK1lpc25NelBJeUc5QUYvMTFlSHJ0RU81YjhQNy82eGVKTlU2R1BBQUFBQUVsRgpUa1N1UW1DQwoiCiAgICAgICBpZD0iaW1hZ2U1NiIgLz4KICA8L2c+Cjwvc3ZnPgo="
LABEL oc.keyword="Tissuumaps"
LABEL oc.cat="development"
LABEL oc.template="abcdesktopio/oc.template.gtk"
LABEL oc.name="tissuumaps"
LABEL oc.launch="tissuumaps.konsole"
LABEL oc.args="--name tissuumaps --hold -e vglrun -c proxy /opt/conda/envs/tissuumaps_env/bin/tissuumaps"
LABEL oc.displayname="Tissuumaps 3.2.1.11"
LABEL oc.path="/usr/bin/konsole"
LABEL oc.type=app
LABEL oc.rules="{\"homedir\":{\"default\":true}}"
LABEL oc.showinview=dock
LABEL oc.acl="{\"permit\":[\"all\"]}"

RUN  if [ -d /usr/share/icons ];   then cd /usr/share/icons;    /composer/safelinks.sh; fi 
RUN  if [ -d /usr/share/pixmaps ]; then cd /usr/share/pixmaps;  /composer/safelinks.sh; fi 

ENV APPNAME "tissuumaps"
ENV APPBIN "/usr/bin/konsole"
ENV APP "/usr/bin/konsole"
ENV ARGS="--name tissuumaps --hold -e vglrun -c proxy /opt/conda/envs/tissuumaps_env/bin/tissuumaps"


RUN conda create -y --name tissuumaps_env python=3.9 -c conda-forge && \
    conda install -y --name tissuumaps_env  libgcc-ng=12 libstdcxx-ng=12 libvips pyvips openslide-python -c conda-forge && \ 
    conda run --name tissuumaps_env python -m pip install torch==2.5.0 torchvision==0.20.0 torchaudio==2.5.0 --extra-index-url https://download.pytorch.org/whl/cu118 && \
    conda run --name tissuumaps_env python -m pip install TissUUmaps[full] numpy==1.26.3

RUN mkdir -p /run/user && chmod 777 /run/user

RUN mkdir -p /etc/localaccount && \
    for f in passwd shadow group gshadow ; do if [ -f /etc/$f ] ; then  cp /etc/$f /etc/localaccount; rm -f /etc/$f; ln -s /etc/localaccount/$f /etc/$f; fi; done


CMD ["/composer/appli-docker-entrypoint.sh" ]


