ARG TAG=3.2
FROM abcdesktopio/oc.template.ubuntu.nvidia.22.04:$TAG
USER root
RUN echo 'debconf debconf/frontend select Noninteractive' | debconf-set-selections

ARG DEBIAN_FRONTEND=noninteractive
ENV NVIDIA_DRIVER_CAPABILITIES all
ENV PATH="/opt/nextflow:${PATH}"

RUN apt-get update -y && apt-get install -y wget konsole openjdk-17-jdk

# Install locales 
RUN apt-get clean && \
    apt-get update && apt-get install --no-install-recommends -y locales && \
    rm -rf /var/lib/apt/lists/* && \
    locale-gen en_US.UTF-8
ENV LANG en_US.UTF-8
ENV LANGUAGE en_US:en
ENV LC_ALL en_US.UTF-8


RUN mkdir /opt/nextflow
WORKDIR /opt/nextflow

RUN curl -s https://get.nextflow.io |bash
RUN chmod 0755 /opt/nextflow/nextflow && \
    mv /opt/nextflow/nextflow /usr/local/bin/

LABEL oc.icon="nextflow.svg"
LABEL oc.icondata="PHN2ZyB3aWR0aD0iOTgiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCA5OCAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGcgY2xpcC1wYXRoPSJ1cmwoI2NsaXAwXzUwNF8xMDUxKSI+CjxwYXRoIGQ9Ik0wIDIuOTQ5MTJDMi41MjQ4IDMuMTE2OCA0LjU0Nzg0IDUuMTQ0OTYgNC43MDY1NiA3LjY3MjMySDcuNjU1MDRDNy40OTEyIDMuNTE0ODggNC4xNTU1MiAwLjE3MjggMCAwVjIuOTQ5MTJaIiBmaWxsPSIjMERDMDlEIi8+CjxwYXRoIGQ9Ik00LjcyMzIgOC4zNDQ5N0M0LjU1NTUyIDEwLjg2OTggMi41MjczNiAxMi44OTI4IDAgMTMuMDUxNVYxNkM0LjE1NzQ0IDE1LjgzNjIgNy40OTk1MiAxMi41MDA1IDcuNjcyMzIgOC4zNDQ5N0g0LjcyMzJaIiBmaWxsPSIjMERDMDlEIi8+CjxwYXRoIGQ9Ik0xMS4yNzY4IDcuNjU1MDRDMTEuNDQ0NSA1LjEzMDI0IDEzLjQ3MjYgMy4xMDcyIDE2IDIuOTQ4NDhWMEMxMS44NDI1IDAuMTYzODQgOC41MDA0NyAzLjQ5OTUyIDguMzI3NjcgNy42NTUwNEgxMS4yNzY4WiIgZmlsbD0iIzBEQzA5RCIvPgo8cGF0aCBkPSJNMTYgMTMuMDUwOUMxMy40NzUyIDEyLjg4MzIgMTEuNDUyMiAxMC44NTUgMTEuMjkzNSA4LjMyNzY3SDguMzQ0OTdDOC41MDg4MSAxMi40ODUxIDExLjg0NDUgMTUuODI3MiAxNiAxNlYxMy4wNTA5WiIgZmlsbD0iIzBEQzA5RCIvPgo8cGF0aCBkPSJNMjEgMTMuMDg5M1YyLjk1MjMzSDIyLjk2NDhWNC41NDc4NUgyMy4yNzU4QzIzLjQ1NzYgNC4xNTg3MyAyMy43ODE0IDMuNzk1ODUgMjQuMjQ4NiAzLjQ1ODU3QzI0LjcxNTggMy4xMjEyOSAyNS40MDk2IDIuOTUyOTcgMjYuMzMwNiAyLjk1Mjk3QzI3LjA1NyAyLjk1Mjk3IDI3LjcwMjEgMy4xMTU1MyAyOC4yNjY2IDMuNDM5MzdDMjguODMxIDMuNzYzODUgMjkuMjc1MiA0LjIyMDgxIDI5LjU5OSA0LjgxMDg5QzI5LjkyMjkgNS40MDA5NyAzMC4wODU0IDYuMTExMzcgMzAuMDg1NCA2Ljk0MTQ1VjEzLjA4OTNIMjguMDgxNlY3LjA5Njk3QzI4LjA4MTYgNi4yNjY4OSAyNy44NzQyIDUuNjU0NDEgMjcuNDU4OSA1LjI1ODI1QzI3LjA0MzUgNC44NjI3MyAyNi40NzMzIDQuNjY0OTcgMjUuNzQ2OSA0LjY2NDk3QzI0LjkxNjggNC42NjQ5NyAyNC4yNTE4IDQuOTM3NjEgMjMuNzUyNiA1LjQ4MjI1QzIzLjI1MzQgNi4wMjY4OSAyMy4wMDM4IDYuODE4NTcgMjMuMDAzOCA3Ljg1NjAxVjEzLjA4OTlIMjFWMTMuMDg5M1oiIGZpbGw9IiMxNjBGMjYiLz4KPHBhdGggZD0iTTY4Ljg5ODMgMTMuMDkzOFYwLjAxODU1NDdINzAuOTAyMVYxMy4wOTM4SDY4Ljg5ODNaIiBmaWxsPSIjMTYwRjI2Ii8+CjxwYXRoIGQ9Ik03Ny43ODM0IDEzLjA5MzdDNzYuODIzNCAxMy4wOTM3IDc1Ljk3MDkgMTIuODk2IDc1LjIyNDYgMTIuNTAwNUM3NC40Nzg0IDEyLjEwNDkgNzMuODkyMiAxMS41MzczIDczLjQ2NCAxMC43OTgxQzczLjAzNTggMTAuMDU4OSA3Mi44MjIxIDkuMTgzMzUgNzIuODIyMSA4LjE3MTUxVjcuODc5NjdDNzIuODIyMSA2Ljg2NzgzIDczLjAzNTggNS45OTU1MSA3My40NjQgNS4yNjI3MUM3My44OTIyIDQuNTI5OTEgNzQuNDc5IDMuOTYyMjMgNzUuMjI0NiAzLjU2MDMxQzc1Ljk3MDIgMy4xNTgzOSA3Ni44MjM0IDIuOTU3NDMgNzcuNzgzNCAyLjk1NzQzQzc4Ljc0MzQgMi45NTc0MyA3OS41OTkgMy4xNTgzOSA4MC4zNTE3IDMuNTYwMzFDODEuMTAzNyAzLjk2MjIzIDgxLjY5NDQgNC41Mjk5MSA4Mi4xMjE5IDUuMjYyNzFDODIuNTUwMSA1Ljk5NTUxIDgyLjc2MzggNi44Njc4MyA4Mi43NjM4IDcuODc5NjdWOC4xNzE1MUM4Mi43NjM4IDkuMTgzMzUgODIuNTUwMSAxMC4wNTg5IDgyLjEyMTkgMTAuNzk4MUM4MS42OTM4IDExLjUzNzMgODEuMTAzNyAxMi4xMDQ5IDgwLjM1MTcgMTIuNTAwNUM3OS41OTkgMTIuODk2IDc4Ljc0MzQgMTMuMDkzNyA3Ny43ODM0IDEzLjA5MzdaTTc3Ljc4MzQgMTEuMzAzN0M3OC42NjUzIDExLjMwMzcgNzkuMzgyMSAxMS4wMjE0IDc5LjkzMzEgMTAuNDU3NkM4MC40ODQyIDkuODkzMTEgODAuNzYgOS4xMTIzMSA4MC43NiA4LjExMzI3VjcuOTM3OTFDODAuNzYgNi45Mzk1MSA4MC40ODc0IDYuMTU3NDMgNzkuOTQyNyA1LjU5MzU5Qzc5LjM5ODEgNS4wMjkxMSA3OC42NzgxIDQuNzQ3NTEgNzcuNzgzNCA0Ljc0NzUxQzc2Ljg4ODYgNC43NDc1MSA3Ni4yMDM4IDUuMDI5NzUgNzUuNjUyOCA1LjU5MzU5Qzc1LjEwMTEgNi4xNTgwNyA3NC44MjU5IDYuOTM5NTEgNzQuODI1OSA3LjkzNzkxVjguMTEzMjdDNzQuODI1OSA5LjExMjMxIDc1LjEwMTEgOS44OTM3NSA3NS42NTI4IDEwLjQ1NzZDNzYuMjAzOCAxMS4wMjIxIDc2LjkxNDIgMTEuMzAzNyA3Ny43ODM0IDExLjMwMzdaIiBmaWxsPSIjMTYwRjI2Ii8+CjxwYXRoIGQ9Ik04NS40NzEgMTEuNDA5OUw4NC4xMDg1IDIuOTU3NDNIODYuMTEyM0w4Ny4zMTg3IDExLjc1MTdIODcuNjI5OEw4OSA0LjU1MTY3Qzg5LjE3NiAzLjYyNjg3IDg5Ljk4NDMgMi45NTc0MyA5MC45MjY0IDIuOTU3NDNDOTEuODY5OCAyLjk1NzQzIDkyLjY3ODcgMy42Mjg3OSA5Mi44NTM0IDQuNTU1NTFMOTQuMjA2NCAxMS43NTFIOTQuNTE3NEw5NS43MjM4IDIuOTU2NzlIOTcuNzI3N0w5Ni4zNjUxIDExLjQwOTNDOTYuMjA5IDEyLjM3OTUgOTUuMzcxMiAxMy4wOTMxIDk0LjM4ODIgMTMuMDkzMUM5My40MjUgMTMuMDkzMSA5Mi41OTg3IDEyLjQwNzcgOTIuNDIwMiAxMS40NjE3TDkxLjA3NDIgNC4zMTg3MUg5MC43NjMyTDg5LjQxNzMgMTEuNDYxN0M4OS4yMzg3IDEyLjQwODMgODguNDEyNSAxMy4wOTMxIDg3LjQ0OTMgMTMuMDkzMUM4Ni40NjYyIDEzLjA5MzEgODUuNjI4NSAxMi4zNzk1IDg1LjQ3MjMgMTEuNDA5M0w4NS40NzEgMTEuNDA5OVoiIGZpbGw9IiMxNjBGMjYiLz4KPHBhdGggZD0iTTYyLjYxMTUgMC41NjEyNjVDNjIuMjY1OSAwLjkxMjYyNSA2Mi4wOTM4IDEuMzgxNzQgNjIuMDkzOCAxLjk2NzM0VjEzLjA5MzdINjQuMTA1M1Y0LjY2MTFINjYuOTc4MlYyLjk2MTlINjUuNTg5NEw2NC40NTY2IDQuMDk0N0g2NC4xMDUzVjIuMjk5NUM2NC4xMDUzIDEuOTA5MTEgNjQuMjkzNCAxLjcxMzkgNjQuNjcxNyAxLjcxMzlINjYuOTcwNlYwLjAzMzkwNUg2NC4wMjcyQzYzLjQyNzUgMC4wMzM5MDUgNjIuOTU1OCAwLjIwOTkwNSA2Mi42MTE1IDAuNTYxMjY1WiIgZmlsbD0iIzE2MEYyNiIvPgo8cGF0aCBkPSJNNTcuMzg5MSAxMC43ODU5VjUuNDU4NTZINTUuMzc3VjExLjEzNzNDNTUuMzc3IDExLjcyMzUgNTUuNTQ5MSAxMi4xOTIgNTUuODk0NyAxMi41NDRDNTYuMjM5NyAxMi44OTU0IDU2LjcwNTYgMTMuMDcxNCA1Ny4yOTE4IDEzLjA3MTRINTkuOTQ4NVYxMS4zNzE1SDU3LjkzNjNDNTcuNTcwOSAxMS4zNzE1IDU3LjM4OTEgMTEuMTc2MyA1Ny4zODkxIDEwLjc4NTNWMTAuNzg1OVoiIGZpbGw9IiMxNjBGMjYiLz4KPHBhdGggZD0iTTQ1LjMyIDEwLjM0MjRDNDQuNzYzMiAxMS4wMDY3IDQzLjk0MTQgMTEuMzMxMiA0My4wNzU1IDExLjMzMTJIMzYuOTcyNUMzNi4xNjQ4IDExLjMzMTIgMzUuNDkwOSAxMS4wODAzIDM0Ljk1MDcgMTAuNTc5MkMzNC45MTc0IDEwLjU0NzkgMzQuODg0MiAxMC41MTY1IDM0Ljg1MjggMTAuNDgzMkMzNC44MjA4IDEwLjQ0OTkgMzQuNzkwMSAxMC40MTY3IDM0Ljc2IDEwLjM4MzRDMzQuNjg3NyAxMC4zMDAyIDM0LjYyMTEgMTAuMjEzMSAzNC41NTk3IDEwLjEyMjNDMzQuMjk2NiA5LjcyNzM4IDM0LjE0NjIgOS4yNTc2MSAzNC4xMDg1IDguNzEzNjFDMzQuMTA0NiA4LjY2MTc3IDM0LjEwMjcgOC42MDkyOSAzNC4xMDA4IDguNTU2MTdINDEuNTA1VjcuNzk0NTdDNDEuNTA1IDYuODE3OTMgNDEuMzA5NyA1Ljk2NDgyIDQwLjkxODcgNS4yMzUyMkM0MC41Mjc3IDQuNTA1NjIgMzkuOTgzNyAzLjkzNjAyIDM5LjI4NzQgMy41MjU3OEMzOC41ODk4IDMuMTE1NTQgMzcuNzc4OSAyLjkxMDEgMzYuODU1NCAyLjkxMDFDMzUuOTMxOCAyLjkxMDEgMzUuMDcxIDMuMTE4MSAzNC4zNTQ5IDMuNTM1MzhDMzMuOTk2NSAzLjc0MzM4IDMzLjY3NzEgMy45OTIzMyAzMy4zOTU1IDQuMjgyODlDMzMuMzYwMyA0LjMxODczIDMzLjMyNTEgNC4zNTU4NiAzMy4yOTEyIDQuMzkzNjJDMzMuMTg4OCA0LjUwNjkgMzMuMDkyOCA0LjYyNTMgMzMuMDAxMyA0Ljc0ODE4QzMyLjg4MDMgNC45MTMzIDMyLjc2NzcgNS4wODkyOSAzMi42NjUzIDUuMjc0ODlDMzIuMjU1IDYuMDE3MjkgMzIuMDQ5NiA2Ljg4OTYxIDMyLjA0OTYgNy44OTI0OVY4LjEyNjc0QzMyLjA0OTYgOS4xMjk2MSAzMi4yNTUgMTAuMDAxOSAzMi42NjUzIDEwLjc0NDNDMzMuMDc1NSAxMS40ODY3IDMzLjY0NTEgMTIuMDYyNyAzNC4zNzQ3IDEyLjQ3M0MzNS4xMDM3IDEyLjg4MzIgMzUuOTU3NCAxMy4wODg3IDM2LjkzNDEgMTMuMDg4N0g0Mi45MTA0QzQzLjQ1NjMgMTMuMDg4NyA0NC41OTgxIDEyLjk5MDEgNDUuMjc1MiAxMi42MTEyQzQ2LjAyNjUgMTIuMTkwMSA0Ni40OTEyIDExLjY4IDQ3LjI1NDEgMTAuNzcwNkw0Ny41NDQgMTAuMzU1OUw0Ni40NDM4IDguNzk0ODlMNDUuMzIwNiAxMC4zNDI0SDQ1LjMyWk0zNC4xMiA3LjAxMzc3QzM0LjEzOTggNi44ODAwMSAzNC4xNjQ4IDYuNzUwNzQgMzQuMTk4MSA2LjYyNzIyQzM0LjIzMDEgNi41MDMwNiAzNC4yNjkxIDYuMzg0NjUgMzQuMzE1MiA2LjI3MTM3QzM0LjQ2NjkgNS44OTQ0MSAzNC42OTIyIDUuNTc1MDUgMzQuOTg5MSA1LjMxMzkzQzM1LjQ2NCA0Ljg5NjY1IDM2LjA3OSA0LjY4ODY2IDM2LjgzNTUgNC42ODg2NkMzNy41OTIgNC42ODg2NiAzOC4yMDMyIDQuODk2NjUgMzguNjcxNyA1LjMxMzkzQzM5LjE0MDggNS43MzEyMSAzOS40MDcgNi4yOTc2MSAzOS40NzMgNy4wMTM3N0gzNS40NDg2TDM0LjQyMDIgOC4wNDIyNUgzNC4wODFDMzQuMDc1OCA3Ljc0NjU3IDM0LjA4MSA3LjM2NTEzIDM0LjEyIDcuMDEzNzdaIiBmaWxsPSIjMTYwRjI2Ii8+CjxwYXRoIGQ9Ik01Ny4zODkxIDIuOTI4NjRWMEg1NS4zNzdWMi45Mjg2NEg1My40ODQ1QzUyLjkzODYgMi45Mjg2NCA1MS43OTY4IDMuMDI3MiA1MS4xMTk3IDMuNDA2MDhDNTAuMzY4MyAzLjgyNzIgNDkuNzU4NCA0LjM2OTI4IDQ4Ljk5NTUgNS4yNzg3Mkw0OC4xNTMzIDYuNDM5MDRDNDcuOCA1LjkyOTYgNDcuNTE1MiA1LjUxOTM2IDQ3LjM4MTQgNS4zMzA1NkM0Ni42OTQ3IDQuMzYyMjQgNDYuMDI2NiAzLjg1OTg0IDQ1LjI3NDYgMy40Mzg3MkM0NC41OTc0IDMuMDU5MiA0My41MTk3IDIuOTYxMjggNDIuOTczOCAyLjk2MTI4SDQyLjU5ODdWNC43MTkzNkg0My4xMzk1QzQ0LjAwNjEgNC43MTkzNiA0NC43NjMyIDUuMDQzODQgNDUuMzIgNS43MDgxNkw0Ni45NjU0IDguMDc0ODhMNDYuOTU4NCA4LjA4NDQ4TDQ3Ljk2NDUgOS41MTIzMkw0OC44MTcgMTAuNzM4NkM0OS41Nzk4IDExLjY0OCA1MC4xODk4IDEyLjE5MDEgNTAuOTQxMSAxMi42MTEyQzUxLjYxODIgMTIuOTkwNyA1Mi43NiAxMy4wODg2IDUzLjMwNTkgMTMuMDg4Nkg1My42ODFWMTEuMzMwNkg1My4xNDAyQzUyLjI3MzYgMTEuMzMwNiA1MS40MzMzIDExLjAyMTQgNTAuODk1NyAxMC4zNDE4QzUwLjY4OSAxMC4wODA2IDQ5Ljk2MTMgOS4wNDE5MiA0OS4yMTM4IDcuOTY3MzZMNTAuODE3NiA1LjY3NDg4QzUxLjM3NDQgNS4wMTA1NiA1Mi40NTIyIDQuNjI3ODQgNTMuMzE4MSA0LjYyNzg0SDYwLjE3MzhWMi45MjhINTcuMzg5MVYyLjkyODY0WiIgZmlsbD0iIzE2MEYyNiIvPgo8L2c+CjxkZWZzPgo8Y2xpcFBhdGggaWQ9ImNsaXAwXzUwNF8xMDUxIj4KPHJlY3Qgd2lkdGg9Ijk4IiBoZWlnaHQ9IjE2IiBmaWxsPSJ3aGl0ZSIvPgo8L2NsaXBQYXRoPgo8L2RlZnM+Cjwvc3ZnPgo="
LABEL oc.keyword="konsole,nextflow"
LABEL oc.cat="development"
LABEL oc.desktopfile="org.kde.konsole.desktop"
LABEL oc.launch="nextflow.konsole"
LABEL oc.template="abcdesktopio/oc.template.ubuntu.nvidia"
LABEL oc.name="nextflow"
LABEL oc.displayname="Nextflow"
LABEL oc.path="/usr/bin/konsole"
LABEL oc.type=app
LABEL oc.rules="{\"homedir\":{\"default\":false}}"
LABEL oc.acl="{\"permit\":[\"all\"]}"


ENV APPNAME "Nextflow"
ENV APPBIN "/usr/bin/konsole"

ENV APP "/usr/bin/konsole"

LABEL oc.showinview="dock"

RUN mkdir -p /run/user
RUN chmod 777 /run/user



RUN mkdir -p /etc/localaccount
RUN for f in passwd shadow group gshadow ; do if [ -f /etc/$f ] ; then  cp /etc/$f /etc/localaccount; rm -f /etc/$f; ln -s /etc/localaccount/$f /etc/$f; fi; done


CMD ["/composer/appli-docker-entrypoint.sh" ]


