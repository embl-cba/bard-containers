ARG TAG=3.2
FROM registry.git.embl.de/grp-cbbcs/abcdesktop-apps/base-image:ubuntu22-cuda-12-3

USER root
ENV DEBIAN_FRONTEND noninteractive
ENV TZ Europe/Berlin
ENV NVIDIA_DRIVER_CAPABILITIES "all"
ENV PATH=/usr/local/cuda-11.4/bin${PATH:+:${PATH}}
ENV LD_LIBRARY_PATH=/usr/local/cuda-12.3/lib64$LD_LIBRARY_PATH:$CONDA_PREFIX/lib/

RUN add-apt-repository -y ppa:mozillateam/ppa && \
    printf 'Package: firefox*\nPin: release o=LP-PPA-mozillateam\nPin-Priority: 1001\n' > /etc/apt/preferences.d/mozilla-firefox 

RUN apt install -y wget && wget -qO- https://cloud.r-project.org/bin/linux/ubuntu/marutter_pubkey.asc |gpg --dearmor -o /usr/share/keyrings/r-project.gpg && \
    echo "deb [signed-by=/usr/share/keyrings/r-project.gpg] https://cloud.r-project.org/bin/linux/ubuntu jammy-cran40/" | tee -a /etc/apt/sources.list.d/r-project.list && apt update -y

RUN  apt-get install -y libasound2 apt-utils apt-transport-https software-properties-common gnupg2 build-essential r-base r-base-dev libssl-dev liblzma-dev libbz2-dev libicu-dev libtiff-dev libfftw3-dev libcurl4-openssl-dev libxml2-dev libssh2-1-dev libgit2-dev libfontconfig1-dev libfreetype-dev libharfbuzz-dev libfribidi-dev default-jre default-jdk git konsole firefox
 


RUN R CMD javareconf


RUN mkdir -p /opt/ide/app && mkdir -p /opt/ide/R/libs && echo 'R_LIBS=/opt/ide/R/libs\n' > /opt/ide/.Renviron

# Copy the app to the image
RUN cd /opt/ide/app && git clone https://git.embl.de/heriche/image-data-explorer.git

# Install required R packages
ENV R_LIBS="/opt/ide/R/libs"
RUN R -e "install.packages(c('remotes', 'rversions', 'roxygen2', 'xml2', 'devtools'), repos=c('https://cloud.r-project.org/', 'https://ftp.gwdg.de/pub/misc/cran/')); \
install.packages(c('data.table', 'shiny', 'DT', 'shinyFiles', 'shinycssloaders', 'shinydashboard', 'shinyjs', 'shinyWidgets', 'shinybusy', 'assertthat'), repos=c('https://cloud.r-project.org/', 'https://ftp.gwdg.de/pub/misc/cran/')); \
install.packages(c('ggplot2', 'plotly', 'RANN', 'MASS', 'dbscan', 'uwot', 'xgboost', 'Ckmeans.1d.dp', 'e1071', 'caret', 'RColorBrewer', 'aws.s3', 'configr'), repos=c('https://cloud.r-project.org/', 'https://ftp.gwdg.de/pub/misc/cran/')); \
install.packages('BiocManager', repos=c('https://cloud.r-project.org/', 'https://ftp.gwdg.de/pub/misc/cran/')); \
install.packages(c('rJava', 'RCurl')); BiocManager::install('EBImage'); BiocManager::install('aoles/RBioFormats'); \
BiocManager::install('Rarr'); library(devtools); setwd('/opt/ide/app/image-data-explorer/imageViewer'); install(); devtools::install_git('https://git.embl.de/heriche/omerarr')"

# IDE is available on port 5476
EXPOSE 5476

# We need to make sure AWS env variables are defined 
# otherwise the R package aws.s3 defaults to us-east-1
# even when region is explicitly set to "" in the code
ENV AWS_S3_ENDPOINT=""
ENV AWS_ACCESS_KEY_ID=""
ENV AWS_SECRET_ACCESS_KEY=""
ENV AWS_DEFAULT_REGION=""


LABEL oc.icon="ide-logo.svg"
LABEL oc.icondata="PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgoKPHN2ZwogICB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iCiAgIHhtbG5zOmNjPSJodHRwOi8vY3JlYXRpdmVjb21tb25zLm9yZy9ucyMiCiAgIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyIKICAgeG1sbnM6c3ZnPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIKICAgeG1sbnM6c29kaXBvZGk9Imh0dHA6Ly9zb2RpcG9kaS5zb3VyY2Vmb3JnZS5uZXQvRFREL3NvZGlwb2RpLTAuZHRkIgogICB4bWxuczppbmtzY2FwZT0iaHR0cDovL3d3dy5pbmtzY2FwZS5vcmcvbmFtZXNwYWNlcy9pbmtzY2FwZSIKICAgd2lkdGg9IjUxMiIKICAgaGVpZ2h0PSI1MTIiCiAgIHZpZXdCb3g9IjAgMCA1MTIuMDAwMDEgNTEyLjAwMDAxIgogICBpZD0ic3ZnMiIKICAgdmVyc2lvbj0iMS4xIgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjkyLjUgKDIwNjBlYzFmOWYsIDIwMjAtMDQtMDgpIgogICBzb2RpcG9kaTpkb2NuYW1lPSJJREVfbG9nby5zdmciPgogIDxkZWZzCiAgICAgaWQ9ImRlZnM0IiAvPgogIDxzb2RpcG9kaTpuYW1lZHZpZXcKICAgICBpZD0iYmFzZSIKICAgICBwYWdlY29sb3I9IiNmZmZmZmYiCiAgICAgYm9yZGVyY29sb3I9IiM2NjY2NjYiCiAgICAgYm9yZGVyb3BhY2l0eT0iMS4wIgogICAgIGlua3NjYXBlOnBhZ2VvcGFjaXR5PSIwLjAiCiAgICAgaW5rc2NhcGU6cGFnZXNoYWRvdz0iMiIKICAgICBpbmtzY2FwZTp6b29tPSIxIgogICAgIGlua3NjYXBlOmN4PSIyNy4yODE4MiIKICAgICBpbmtzY2FwZTpjeT0iMTM0LjQzOTQ5IgogICAgIGlua3NjYXBlOmRvY3VtZW50LXVuaXRzPSJweCIKICAgICBpbmtzY2FwZTpjdXJyZW50LWxheWVyPSJsYXllcjEiCiAgICAgc2hvd2dyaWQ9ImZhbHNlIgogICAgIHVuaXRzPSJweCIKICAgICBpbmtzY2FwZTp3aW5kb3ctd2lkdGg9IjE2NDQiCiAgICAgaW5rc2NhcGU6d2luZG93LWhlaWdodD0iMTA4NCIKICAgICBpbmtzY2FwZTp3aW5kb3cteD0iODk0IgogICAgIGlua3NjYXBlOndpbmRvdy15PSIyODQiCiAgICAgaW5rc2NhcGU6d2luZG93LW1heGltaXplZD0iMCIKICAgICBmaXQtbWFyZ2luLXRvcD0iMjAiCiAgICAgZml0LW1hcmdpbi1sZWZ0PSIyMCIKICAgICBmaXQtbWFyZ2luLXJpZ2h0PSIyMCIKICAgICBmaXQtbWFyZ2luLWJvdHRvbT0iMjAiIC8+CiAgPG1ldGFkYXRhCiAgICAgaWQ9Im1ldGFkYXRhNyI+CiAgICA8cmRmOlJERj4KICAgICAgPGNjOldvcmsKICAgICAgICAgcmRmOmFib3V0PSIiPgogICAgICAgIDxkYzpmb3JtYXQ+aW1hZ2Uvc3ZnK3htbDwvZGM6Zm9ybWF0PgogICAgICAgIDxkYzp0eXBlCiAgICAgICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZSIgLz4KICAgICAgICA8ZGM6dGl0bGU+PC9kYzp0aXRsZT4KICAgICAgPC9jYzpXb3JrPgogICAgPC9yZGY6UkRGPgogIDwvbWV0YWRhdGE+CiAgPGcKICAgICBpbmtzY2FwZTpsYWJlbD0iTGF5ZXIgMSIKICAgICBpbmtzY2FwZTpncm91cG1vZGU9ImxheWVyIgogICAgIGlkPSJsYXllcjEiCiAgICAgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTQyLjcxMzc2LC00MzguNjk2MTIpIj4KICAgIDxnCiAgICAgICBpZD0iZzQzMjkiCiAgICAgICB0cmFuc2Zvcm09InRyYW5zbGF0ZSgzLDApIj4KICAgICAgPHJlY3QKICAgICAgICAgcnk9IjQ5LjU5NDkwMiIKICAgICAgICAgeT0iNDgxLjkzNTc2IgogICAgICAgICB4PSI3My41NDk1OTEiCiAgICAgICAgIGhlaWdodD0iMzMxLjUwMjc4IgogICAgICAgICB3aWR0aD0iNDQyLjAzNTcxIgogICAgICAgICBpZD0icmVjdDQxNzYiCiAgICAgICAgIHN0eWxlPSJjb2xvcjojMDAwMDAwO2NsaXAtcnVsZTpub256ZXJvO2Rpc3BsYXk6aW5saW5lO292ZXJmbG93OnZpc2libGU7dmlzaWJpbGl0eTp2aXNpYmxlO29wYWNpdHk6MTtpc29sYXRpb246YXV0bzttaXgtYmxlbmQtbW9kZTpub3JtYWw7Y29sb3ItaW50ZXJwb2xhdGlvbjpzUkdCO2NvbG9yLWludGVycG9sYXRpb24tZmlsdGVyczpsaW5lYXJSR0I7c29saWQtY29sb3I6IzAwMDAwMDtzb2xpZC1vcGFjaXR5OjE7ZmlsbDojZmZmZmZmO2ZpbGwtb3BhY2l0eToxO2ZpbGwtcnVsZTpub256ZXJvO3N0cm9rZTojMWEyZTQ2O3N0cm9rZS13aWR0aDozMC45ODgwOTI0MjtzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6NDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLWRhc2hvZmZzZXQ6MDtzdHJva2Utb3BhY2l0eToxO2NvbG9yLXJlbmRlcmluZzphdXRvO2ltYWdlLXJlbmRlcmluZzpvcHRpbWl6ZVF1YWxpdHk7c2hhcGUtcmVuZGVyaW5nOmF1dG87dGV4dC1yZW5kZXJpbmc6YXV0bztlbmFibGUtYmFja2dyb3VuZDphY2N1bXVsYXRlIiAvPgogICAgICA8cGF0aAogICAgICAgICBpbmtzY2FwZTpjb25uZWN0b3ItY3VydmF0dXJlPSIwIgogICAgICAgICBpZD0icGF0aDQyMTgiCiAgICAgICAgIGQ9Im0gMzU1Ljg0MSw4NTEuNTUyNDUgLTMxLjQ0MzI2LDAuMzY0MDIgYyAtNy45NjE4MywwLjA5MjMgLTE4LjE3ODk4LDAuMTczMDkgLTI4LjI1Mjc1LDAuMjM3NTggbCAwLjIzODA1LDczLjc5MzYgYyAzNy4wODYyNSwwLjA2NjYgNzMuMDYyODcsMC4xMzY2NCA4NS40OTkwMiwwLjE4Nzc2IGwgMzMuODM2MTUsMC4xMzc5NCAwLjMzNTc1LC00LjI4NzgyIGMgMC40NTk1NiwtNS44NjMzNCAwLjQyNDgsLTE3LjAwOTAzIC0wLjA1MzMsLTE3LjAyNjc5IC0xMC4wMjE4MiwtMC4zNzIzMSAtNDIuMjgzMywtMi4xOTkwOCAtNDIuNjAyOTUsLTIuNDEyMTUgLTAuMjQ3NDQsLTAuMTY0OTIgLTQuMjk4OTMsLTExLjcwNTMgLTkuMDAzMDgsLTI1LjY0NjUxIGwgLTguNTUzNjQsLTI1LjM0NzYzIHoiCiAgICAgICAgIHN0eWxlPSJvcGFjaXR5OjE7ZmlsbDojMWEyZTQ2O2ZpbGwtb3BhY2l0eToxO3N0cm9rZTojMWEyZTQ2O3N0cm9rZS13aWR0aDo5LjQ0NTczNzg0O3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2UtZGFzaG9mZnNldDowO3N0cm9rZS1vcGFjaXR5OjEiIC8+CiAgICAgIDxwYXRoCiAgICAgICAgIGlkPSJwYXRoNDIxOC0zIgogICAgICAgICBkPSJtIDIzMy4yOTM4OSw4NTEuNTUyNDUgMzEuNDQzMjYsMC4zNjQwMiBjIDcuOTYxODMsMC4wOTIzIDE4LjE3ODk4LDAuMTczMDkgMjguMjUyNzUsMC4yMzc1OCBsIC0wLjIzODA1LDczLjc5MzYgYyAtMzcuMDg2MjUsMC4wNjY2IC03My4wNjI4NiwwLjEzNjY0IC04NS40OTkwMiwwLjE4Nzc2IGwgLTMzLjgzNjE1LDAuMTM3OTQgLTAuMzM1NzUsLTQuMjg3ODIgYyAtMC40NTk1NiwtNS44NjMzNCAtMC40MjQ4LC0xNy4wMDkwMyAwLjA1MzMsLTE3LjAyNjc5IDEwLjAyMTgyLC0wLjM3MjMxIDQyLjI4MzMxLC0yLjE5OTA4IDQyLjYwMjk2LC0yLjQxMjE1IDAuMjQ3NDMsLTAuMTY0OTIgNC4yOTg5MiwtMTEuNzA1MyA5LjAwMzA3LC0yNS42NDY1MSBsIDguNTUzNjQsLTI1LjM0NzYzIHoiCiAgICAgICAgIHN0eWxlPSJvcGFjaXR5OjE7ZmlsbDojMWEyZTQ2O2ZpbGwtb3BhY2l0eToxO3N0cm9rZTojMWEyZTQ2O3N0cm9rZS13aWR0aDo5LjQ0NTczNzg0O3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2UtZGFzaG9mZnNldDowO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgICAgIGlua3NjYXBlOmNvbm5lY3Rvci1jdXJ2YXR1cmU9IjAiIC8+CiAgICAgIDxpbWFnZQogICAgICAgICB3aWR0aD0iMjk3LjQyMTMiCiAgICAgICAgIGhlaWdodD0iMjk5LjE5MDE5IgogICAgICAgICBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIgogICAgICAgICBzdHlsZT0iZmlsbDojZmZmZmZmO2ZpbGwtb3BhY2l0eToxO2ltYWdlLXJlbmRlcmluZzpvcHRpbWl6ZVF1YWxpdHkiCiAgICAgICAgIHhsaW5rOmhyZWY9ImRhdGE6aW1hZ2UvcG5nO2Jhc2U2NCxpVkJPUncwS0dnb0FBQUFOU1VoRVVnQUFBVWNBQUFFeENBWUFBQUR2TW1DM0FBQUFCSE5DU1ZRSUNBZ0lmQWhraUFBQUU0TkpSRUZVIGVKenQzVDJJWGVlZHgvRy9qQmtFWTRQaklsc0VyQVhiSklVTGV4ZUJnOFRzVG1GR0xNYUVLSTBoVlNwTGtEV1R5cWpZNEJSaU8yRzggMktwU0JkS3N0dENLeFNMRndHQW5CaEhpd2tWQWNpRkRpazJoRGNRRFFpeDNVb3l2NStyT2ZUa3Z6L1A4Mzc0ZlVDVnA1cm4zbnZPNyB2K2VjNTV4ejZ2RHc4RkFBQUk5NWdtd0VnTWROSmhONVFrU0VnQVNBSTVQSlJFVGtLQnhGQ0VnQW1BYWp5RXc0aWhDUUFQS2FEVWFSIHVYQVVJU0FCNURNZmpDSUx3bEdFZ0FTUXg2SmdGRmtTamlJRUpJRDRsZ1dqeUlwd0ZDRWdBY1MxS2hoRjFvU2pDQUVKSUo1MXdTalMgSVJ4RkNFZ0FjWFFKUnBHTzRTaENRQUx3cjJzd2l2UUlSeEVDRW9CZmZZSlJwR2M0aWhDUUFQenBHNHdpQThKUmhJQUU0TWVRWUJRUiBlWExvTHlRZ2dWZzJyK3dYLzVrLy9jdmV3My8vNE9lbmkvL2dqc2JrMUtEbUNBQmR2UC9NdGxvd2prVTRBcWpTR2x2ODdKb0lSeUM1IGR5Ni8rMUI3REJZUmprQnlMYWErSHRzajRRZ2s1akcwV2lFY0FUVGhMWWdKUnlBcGpiRHlkSHlUY0FRUzBnb3BUMHQ3Q0VjZ0ljMlEgOGpLOUpoeUJaTHlFa3piQ0VVQnpIZ0thY0FRUzhSQktWaENPQUZSWUQyckNFVWpDWWhoWkhOTVU0UWdrNEdsOW9SV0VJNUNBNWZXRiBWdHNqNFFnRVp6VjhyQ01jQWFpekdPQ0VJd0FzUURnQ1VIZHdkVXQ3Q0NjUWprQndGb1BIQThJUlNNQnlRRm9kRytFSVFJM1ZZQlFoIEhJRTBMQWVSUllRakFCWFd3NXB3QkJLeEhraVduSnBNSm9mYWc0akk0cUxXR2tyc2JCczd1d1ZHRXNlajI5ZXEvdzd0N2JOVlNCOGUgRG84M21tTUZYT1RmM1J0blg3K3ZQUVpnRWNLeEFzc1grVnZ6MGJNdm50RWVnelV0bXJUbTlOckwxSjV3TEV4N3VvSVlvalpxTDhFbyBRamhpQkU4YnVqY3RHaldmMzJxRVkwRzB4bjZpdHFOU29wMm84aGJHaEdNaG5JVHBqK09OK3J3RlZrdFBhZzhnQ2s3Q3hGRnpLVTNmIE5yaXhzMXQ5YWMvQjFhM3FzeDZQSVV4ekxDRGpkTnJqeHQ1Rml6V0c4SUZ3aElxc3h4dUhoSy8zcFQxZXYwaVpWbytVc1RXV1lQRjQgbytYVzJHcDZqV00wUjBEYUJxUGxFTVl4d25HRXJLMlJoakdlMWVrMWpoR09BN0YwWnpock96bE5Eb3NRamdPeGRBZGowUjV0SXh3SCB5RHFkam9qV2lHVTRXNDFlT041WTFxUGIxMHd1RE5jd3BoWFhlRDlvamoxRmJvMEhWN2UrK1ZPTHBmV05WZ0xtd29PN3ZkK1RhTlByIHNhK254blpGYzhSQzh3Rlo2a3ZCeXZwR0s4RW9Jbkx6enEwejBjS3VqeEt2dmNaMlJYUHNJWHByWFBmM1RLbnI0ZVRNZUtYZkQ4S3ggSTVidXhHR3BOV1puT2VBSng0NVl1ak9lcGVPTkZ0RWV4eXY1ZmhDT0hVU2VUcmRrNFhoanhOYjRyOCsvZkY1N0RFTllEM2JDRWMyTyBKVDY2ZmUyYlB4b3UzZHN6SHlKRDNwdnJMMngvWEdFb1ZiMWRNZEJMaFM3UHJWNGpRMnUwY0tLbFJZdncxQnFIdkIvUlgxOWZqMjVmIDQ3blY4Szkyby9RVUhORlpuMDVQRVk0clpHaU5zT25IZi9yOUIzMy9qNWZRYVdYcyswRTRMcEZsNlk2RktmWFVtNis4dHFjOUJpdCsgOVoxL3ZLdzloaG84QlRqaHVBUkxkOXE3OGUyWHRtdjliRTg3NVJoWlhtY0xoT01DVEtkaitzbEwvOVI3cXFwaGJNQnRuYnRvZHRiaiA2ZGd2NFlnMGZ2V2RmekEvVlMzUi9ENTk2amxtUFRJK2lBbkhPWmxhbzZYamphMWttWFphZnAxZTJpTjM1Wm54enVWM0h3ckhHbFZZIDNwbGJHZnNlZUFrZEVaR0xmLzU4citZeDVoTHZCYzF4QmlkaGNvZ1l4SjZDVVVUazEzLzRUYlZnTEhVbEZPSDR0VXpUYWRnVE1iRFggcVJYbzczM3hXWkhMS1FuSHBESWViNXhsS1l6RzNxM0lXMnVzcWVSN1FUZ0tyVkdiVmxCWkNjZ3hkeXZ5SG95V3gwODRBb3FzQkhRRSBwWU0yZlRqU0duUHpIRTZXVzFjZlZsOUg2bkRNY3YzMHZPekhHNjN3SE16VzhHald3bGk2bzg5Q1FGZ1lRMTlXMjlaUVkxNVByWnNZIHAxMEV6blFhbWp3R2NtMGpBckxLbmREVGhpTXdhMk5udDFrYmEzMGxUT3NnanRKcVV6NG1JWE5ydEh5ODBVS2JhckZqajNtZDFvTnggeWtwQWpubE1BczBSWnN6dVVBZC8vZXRiMy9yUnYxMVhIRTRWTGNQS3dwZU5aK2xPeUdSdWpaNXNQdjMwZFkwbkZWb09GQ3R0ckF2TCA3Mk5YcVpvamQ5M3hhUm9LVytjdVBteHhyOElJTzNhRTE2QXQxVEhIN0szUjh2SEd2ckx0L0Y2T05jN1RicnM4bXJXRDdNRVlqY2FVIFc4dUZCM2Q3M1pqQ1NqQ0tqTCtwaHFZMDRZaVlNb1RrelR1M090K1l3dHJ6WThiY1ZFTmJpbkNrTmNZWE5TVDd2aWFMejQreDFHVDcgU0hWQ0pyTkl4eHRYbVlhSjF4MXlqQnF2ZWNnWFRwVDNQbnh6cERYbUZLRkZhcitHb2Rjc0x4cTN4OEFNSFk0RVkyNVJwOXFMMUFpZiBVbzhiOENwME9BSWlQa05TZTd4amYzK0U5aGcySEdtTng3SWNiMXhITzNDNjhycW1zUXRQWXcwYmpzQWlIbHZrS2xaT3d0VDhPVnBDIGhpT3RFZXRZM1hHdGptdW9SUXZZdmJUSGNPRklNS0tyUjdldnlZLy85UHNQdE1jeGxPWFdPTlZuQWJzMTRjSVJqK040NDJxLy9Iei8gc3BXMnBqMk9Xci9mNjhtWlVPRklhOFJRMnNIVWw0ZHc4UzVVT0FKamFBYWtkamkvK3RXWFZhL0o5dGdldzRRanJSRWxhSVNVaGFVNyB0YS9KWGpabXl3RVpKaHh4RXNjYmg3RzgzS2RtbUx6OS9NdFZIbkhxVllod3BEV2loaFlCYVNtRVAzeGh1OHJsZ3VzQzNXcDdkSDlYIEhoNTlnRVhlT1B2Ni9XWDNFdXdUU0k5dVh6T3o4N1lZUitsSDFGcDU3NFp3M3h6Zkp4Z3haMk5uZCtWTlZqZDJkbnZ0dEpiYUhkcHggSFk1TXA1Zkxlcnl4VCtoNUM4aFdZeWpWOWp5M1JoSG40UWkwVkNPY3ZBZElDUmErZUJaeEc0NjBSajgycit3MytieUdCRTNmLzZPOSBJM3RwanhGQzMyMDR3cDlwU0hyL1lydjQ1OC8zU3Y0OHF3RTlOT0RlZk9XMXp1K1A5cGZOS2k3RDBmdk9WWnVINDQyZWcvTFhmL2pOIGR1bWZHYUZwVGQzNDlrdWQzaC9Md1NqaWNDa1BTM2Q4NlJKKzAzL2pJZFNudEpmNHRQcjlrVUs3TDNmTmthVTdjWGxya3FXYlQ2WWcgc3Q0YVJadzFSMDg3VGl1ZTJsWlhucHFrWm9QVWJxL1J1V3VPT09ZaFBNYm8yeVNIdEpFU0RZWXJTdnJ4MEJwRkhJVWpyZEdmVXAvWiA1cFg5bzJQTmhwWGM0ZC82M3F1WE5INHZIdWNpSEszdkdLanYvV2UyVDNjSjI3N1hUVnYweXpQZi83RFB2N2Y2T2hieE5GWVg0Y2hKIEdFeDFtV3F2dStWWXJWdVNNYjFlelZNd2lvaWNta3dtaDlxRFdJWHA5R0llampmVy91eXN2Z2VsZ3MzQ1RYQkwwZ2pIdzhQaDhlYWkgT2NLZkZsOXFIbzVGam1FOTdQcncxaHBGakljanJSSHJkRDBXMlpKV0VIZ01JTXRNaHlQUVZkU0E3TnNlYXo4b2F3aXZvVzAySEsxdCA3SlpZUGRZMjYrRHExamQvV29tNnpmUUp5UDFQYnBnNmVYbmh3ZDM3Mm1NWXltUTRSajZPbEZIV2dHUjZMWEx6enEybGQyUzN6bVE0IHNuUUhZMFFNU0k4blp5eUY5QkRtd3RIU2hvMHlOR1lDMmJjajc4RmtnYmx3eEdvZWpqZk8wNW9KV0FuSWpPMHhRamliQ2tjckd6UGkgeUx4TlJRZ29UYWJDRWFqQlFrQnF0Y2RMOS9iT0YvbkZQVVFKWlRPWEQxcllnRDN3T0syMjh0bHF2M2NscDhWUkFxZzI5NWNQV3RsNSBVSjZsejFaN0xBU2FMeWJDRWQxb041OEl0QU95RkU4blo3eFNEOGNvR3l2UUJlM1JEL1Z3QkZxTDhvVk1lNnhMTlJ5amJLUll6UExuIHF6azJib3JyQTgzUkNZNDNsc2MxL0ZoRkxSd3R0d3Jrb0hrTmY5YjI2R21zS3VISU56YXM0RXU2SFUvQktDTHlwTVl2NWE0N3k4MVAgbjczdXZGN0g3ZFhHenE2Yk0rRmV4dHI4Q2hsMm10V2lIRnYwOWpscnZlL2UybFFwbCs3dG5YL3ZpODgrcnYxNzNGOGhneU5SZ3RFaiBEdlcwOWVFTDI5V0RjYXltNGVpdFRTQVByVU05SHFhWHRWaHZ6YzNDa1cvbVBMeCtDYktOWWxhemNPUWtES3hqRzIzUGNudHNFbzVlIG0wUnJtMWYySC91RDlqVGFZK2FwdFdXY2tER01nR3lQOXRpZTFmWllQUnpad1hPSmNOd3V3bXZ3NW8yenI1dDd2alhORVVWRmFGNFIgWG9NM0h6Mzdvcm5uVzFjTlIxcmpPRVBYUFhMTTBoK09POXFiWGxjTFI2WW0rZ2pJNFhqdlVPM2FhcVltT1VXNU5odzZMRjEzWFNVYyAyU0gwOE43NzllcFhYejc4OUtubm1wZUtNV0ZrYlNwY0VpZGtqTks4enBwamxrZGF2d2Y3bjl4d0ZZeTFXQW5jNHMyUm5jcU9zUUU3IC8xbHlZNHhZU2dUam85dlhxb1NaaGVtMXl2MGM0Uk5oaVV5S1RxdHBqYnBLdlA5OVZobXN1OXd4d3ZZUTRUVXNVcktWMVdwNDJ0UHIgWXMzeG5jdnZQaFRPVUJlemVXVi9WRE1iK24vSHJES0lHaVF0MVpxbURySHE4NXpmdml5TnU1Uml6WkdsTytYTnRqTFdqYUtVTGsxdiAzUmRkcXk5Q3pjQXRFbzQwaHZyZWYyYjc5S3F3SkR6UnhZVUhkNnRkdzF4cmV2MzI4eStmci9LRDF5anlEQm5DMFo0aDAybyt4K1ZhIG5ueXEyWlpLdE1aWjgrOUxyYkVQRFY3Vlo4aXdROW56MDcvczBTSnhRcGVBR1RzRGlYUnloa1hnQWMxT3dZRSsrcDQ3aUx5TmpUcGIgSGZtTmlZSzFpUkFwUDUxZTk3c2lMQXluT1NhemJHMGlYM1IyYUYwWlV2S0w4OUs5UFpXVEtDVVJqc2t4L2Nhc3ZnRzU3Ti9YZUM1MSA2eStOVWVISUZBMVplUDhDMFZvTzQ5bm81a2hBQXZiMWFYSmQ5K2xsLzY3RzhVYU5RdzFNcTRFa3ZGN2VwM1g4c2tnNDBoNkJXTmJ0IDB5MWI0M3RmZkZiOCtHVVgzTElNU0tUUGNwaStwU2ZLZEhxcTJMU2E5Z2dna3FMSEhBbEl3TDVhQzdSTDA3NFRPQ2RrZ0lTMnpsM2sgK3ZzMWlvY2o3Ukd3citSVERpTzJSaEdhSTVCV2lWQ3JzYmpjUWpDS1ZBcEgyaU9RUTQzTEJLMWdLUStRbUxXRjRWWmFvMGpGYVRYdCBFWUJuVlk4NUVwQUF1ckxVR2tVNElRTUFDMVUvNW5od2Rjdjk3WjVhOE5DeStSeFJpN1hXS0VKekJEcng4T1hsbGNWZ0ZHa1VqbXhZIEFMeGhLWThDcjE4V1hzY051NnkyUnBHRzRaajkyQ1BCZ3E2c3JUM01xdWt4eDZ3QmtmVjFBNnRZYm8waW5KQ3BqbUFFVHJydzRPNTkgN1RHczB6d2NDUXNBTisvY09xTTloblZvamhYeFJRQ2NaSDA2UGFVU2pvUUdBT3ZVbWlNQkNlVGpwVFdLTUswR1RHRVpqeDJxNFVoNyBCUEx3MUJwRmFJNEFHdmkvLy96Rlc5cGo2RXM5SEdtUFFIeWJUejk5WFhzTWZhbUhJNEFqVVIrWDZtMDZQV1VpSEdtUFFObkhwV0k4IEUrRW9Ra0FDRVhsdGpTS0d3aEVBTERFVmpyUkhaQlZ4ZmFQbjFpaGlMQndCeE9BOUdFVU1oaVB0RVlBRjVzSVJnRzhSV3FPSTBYQ2sgUFNLVGlNY2JJekFaamlJRUpPQlJsTllvWWpnY2dRemVPUHU2K2NjRlpHVTZITDIzeDh4UFcwUTNIejM3b3ZuSEJYUVZxVFdLR0E5SCBBRDVFQzBZUkIrRkllMFJVbklpeHpYdzRSa0JBSXJLSXJWSEVTVGg2YjQ4aVJ3RzVlV1ZmM3JuOGJzamJVcUdmTjE5NWJVOTdERmp0IDFHUXlPZFFlUkZjMHNKTnFmM0ZFZnM4MXYzU2pUS210dDhiRHcrSHg1cUk1QXFWRm1JMW8rOG45MzEzU0hrTk5yc0tSRFJvUlJHbU4gMS8vNDZZZmFZNmpKVlRnQ0pmQWxPNTcxNlhRSjdzS1JEUnRqYUc4L1VWcGpCdTdDVVVSL0E0ZFBiRGRsWkdpTklrN0RFZkNJMXVpTCAyM0NrQmFBUHRwY3lzclJHRWNmaENIUmxJUmdqdE1aTXdTamlQQnd0YlBTd3pjSTJzblh1SWxkRk9lUTZISUZWTEFTamlNaW5UejEzIFduc01ZMlZyalNJQnd0SEtEZ0Jickd3WEVhYlRXYmtQUnhFN093SnNZSHNvSzJOckZBa1Nqc0NVcFdDa05mb1dKaHd0N1JSbzcrRHEgbHFsdElFb3dabTJOSW9IQ0VYbFpDc1ZJTWdlalNMQndaQ2ZKeCtKbkhxVTFadmVrOWdDQUlTeUdva2ljWU16ZUdrV0NOVWNSdXpzTiB5dUV6Umd2aHdsR0VuU2N5eTU4dHJURVdwdFZ3d1hJb2lzUUpSaHdMMlJ4RjdPOU02TWJhRXAxRklnVWpyZkVZelJFbVdRL0VpQWpHIHg0VnRqaUxzWUI1NWFJcXpJclZHUEk3bUNCTThCZUpVcEdDa05aNFV1am1LK056cE12SFdGS2NpQlNNV1M5RWNENjV1eWVhVmZlMWggNEdzZXczQld0R0NrTlM2V0loeWhyMFFnTGd1bGxqdDN0R0M4ZEcvdnZJaDhyRDBPaTA1TkpwTkQ3VUcwRXJFOTFtNWhROSt6a3VQcSBFa2d0QWpKYU1JckViNDJIaDhQamplYUlVV3FIYzlkQTJ0alpyYnFqRTR6NXBHcU9Jdkhhby9mamQ2c01DYVFhTzN6RVlCVEpFWTVqIG1tUDRzOVh6SW9jSnlpTVk4MG9Yam9pdFpKaEZEVVowa3pJY2FZLzJhUWVUOXUrdmlkYllUY3B3QkZZaEdDR1NPQnhwajdacDdNUnYgUC8veStjakJpSDVZeW9OUWhvYnF4czZ1eUF2Ym9SZEQweHI3U2RzY1JXaVBPRUpieENLcHcxR0VnTFNzYjlNWjBveXlCQ090c2IvMCA0UWpidXU3VWZYZitqWjNkTk1HSVlRaEhvVDFhdHk3NGhnUmpKclRHWVRnaEF4ZEs3T0RaUWxHRVlCeUQ1dmcxMm1Oc0dZTVI0OUFjIEVWcm1VS1ExamtOem5FRjdqQ1Z6TUdJOHduRU9BZWtmWjZKcGpTVXdyVVlZMlFOeDZ0V3Z2bndvSXFlMXgrRmR1cHZkZHVYbHByZzAgWFVKeEhxM3hHRGU3QlNBaUJHTkpoT01TTkRJL0NBVFVRRGdDUWZBbFVSYmh1QUx0MFkrZEIzZnZhNDhCc1JDT2F4Q1FQdnozblZ0biB0TWVnaWRaWUh1RUlPRWRycm9PbFBCMVpYZHJqc2RrdVducFRxdmxrWE5aRGExeHV6RkllRm9HanVpNkJ0Ykd6eTA0K0FPOVpQWVJqIFJ3ZFh0OHkyUnd2KytkekYvLy90VTgrcGIwK1BibDlMMlI1Ukh0UHFucXdGWkl0cGRjdXc0YjZOM2RFYTErTUtHV0FHb1lFU0NNZWUgUEo0QThlUm5mLy9TRDdYSDRBRmZBUFVSampEbFA3NzcybitWK0RtUnd5UHlhN09FY0J5QTlnakVSempDbkZJblZDSTJySWl2eVNyQyBjU0RhSXhBYjRUZ0NBVmtQN2ZHa1NLL0ZBOElSQUJZZ0hFZWlQZFpUcWoxKy9Vd1YxMmlON1JHT0NHLy9reHV1SHpaRk1Pb2dIQXVnIFBkYVQ1VkpBMkVNNElnV3Y3Y3ZydUNNZ0hBdWhQZFpEZTRRR3dyRWdBdEkyYnkzTTIzaWpJUnpod2cvTy9zdi9hbytocFFzOCtrQWQgNFZnWTdiR08vM24ydTM5WDR1ZDRhV00za3o4d3pBTENFVERHUzRCSFJ6aFdRSHVzZzBzSzBkS294eVNNdVFVNUFGZzJ1RGtTakFBaSBHeFNPQkNPQTZIcUhJOEVJSUlOZTRVZ3dBc2lpY3pnU2pBQXk2UlNPQkNPQWJOYUdJOEVJSUtPVjRVZ3dBc2hxYVRnU2pBQXlXeGlPIEJDT0E3RTZFSThFSUFIUGhTREFDd0pGdndwRmdCSUJqVDRnUWpBQXc3Mjg0bWJlbjBjV3FNUUFBQUFCSlJVNUVya0pnZ2c9PSAiCiAgICAgICAgIGlkPSJpbWFnZTQyNzciCiAgICAgICAgIHg9IjE1MC40MDQ1MyIKICAgICAgICAgeT0iNDk4LjA5MjA3IiAvPgogICAgICA8ZWxsaXBzZQogICAgICAgICByeT0iNS41MzE2ODU4IgogICAgICAgICByeD0iNC42Nzg3NDg2IgogICAgICAgICBjeT0iOTE0LjE4NTE4IgogICAgICAgICBjeD0iMzk0Ljg0MjE5IgogICAgICAgICBpZD0icGF0aDQyOTkiCiAgICAgICAgIHN0eWxlPSJjb2xvcjojMDAwMDAwO2NsaXAtcnVsZTpub256ZXJvO2Rpc3BsYXk6aW5saW5lO292ZXJmbG93OnZpc2libGU7dmlzaWJpbGl0eTp2aXNpYmxlO29wYWNpdHk6MTtpc29sYXRpb246YXV0bzttaXgtYmxlbmQtbW9kZTpub3JtYWw7Y29sb3ItaW50ZXJwb2xhdGlvbjpzUkdCO2NvbG9yLWludGVycG9sYXRpb24tZmlsdGVyczpsaW5lYXJSR0I7c29saWQtY29sb3I6IzAwMDAwMDtzb2xpZC1vcGFjaXR5OjE7ZmlsbDojMWEyZTQ2O2ZpbGwtb3BhY2l0eToxO2ZpbGwtcnVsZTpub256ZXJvO3N0cm9rZTojMjViMmZhO3N0cm9rZS13aWR0aDoxLjUyMzQ4ODc2O3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1kYXNob2Zmc2V0OjA7c3Ryb2tlLW9wYWNpdHk6MTtjb2xvci1yZW5kZXJpbmc6YXV0bztpbWFnZS1yZW5kZXJpbmc6b3B0aW1pemVRdWFsaXR5O3NoYXBlLXJlbmRlcmluZzphdXRvO3RleHQtcmVuZGVyaW5nOmF1dG87ZW5hYmxlLWJhY2tncm91bmQ6YWNjdW11bGF0ZSIgLz4KICAgICAgPGVsbGlwc2UKICAgICAgICAgcnk9IjEuNjk5NjY4MyIKICAgICAgICAgcng9IjEuMzUwODA5NyIKICAgICAgICAgY3k9IjkxNC4xODUxOCIKICAgICAgICAgY3g9IjM5NC44NDIxOSIKICAgICAgICAgaWQ9InBhdGg0MzAxIgogICAgICAgICBzdHlsZT0ib3BhY2l0eToxO2ZpbGw6bm9uZTtmaWxsLW9wYWNpdHk6MTtzdHJva2U6IzA5YTRmNztzdHJva2Utd2lkdGg6MC45NDQ1NzM4MjtzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW1pdGVybGltaXQ6NDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLWRhc2hvZmZzZXQ6MDtzdHJva2Utb3BhY2l0eToxIiAvPgogICAgPC9nPgogICAgPHRleHQKICAgICAgIHhtbDpzcGFjZT0icHJlc2VydmUiCiAgICAgICBzdHlsZT0iZm9udC1zdHlsZTpub3JtYWw7Zm9udC12YXJpYW50Om5vcm1hbDtmb250LXdlaWdodDpub3JtYWw7Zm9udC1zdHJldGNoOm5vcm1hbDtsaW5lLWhlaWdodDowJTtmb250LWZhbWlseTpBcmlhbDstaW5rc2NhcGUtZm9udC1zcGVjaWZpY2F0aW9uOidBcmlhbCwgTm9ybWFsJzt0ZXh0LWFsaWduOnN0YXJ0O2xldHRlci1zcGFjaW5nOjBweDt3b3JkLXNwYWNpbmc6MHB4O3dyaXRpbmctbW9kZTpsci10Yjt0ZXh0LWFuY2hvcjpzdGFydDtmaWxsOiNmZmZmZmY7ZmlsbC1vcGFjaXR5OjE7c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjFweDtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIgogICAgICAgeD0iMjM2LjcxMzc2IgogICAgICAgeT0iODkwLjY5NjExIgogICAgICAgaWQ9InRleHQ0MTQwIj48dHNwYW4KICAgICAgICAgc29kaXBvZGk6cm9sZT0ibGluZSIKICAgICAgICAgaWQ9InRzcGFuNDE0MiIKICAgICAgICAgeD0iMjM2LjcxMzc2IgogICAgICAgICB5PSI4OTQuMDA1MTkiCiAgICAgICAgIHN0eWxlPSJmb250LXNpemU6MzVweDtsaW5lLWhlaWdodDoxLjI1IiAvPjwvdGV4dD4KICA8L2c+Cjwvc3ZnPgo="
LABEL oc.keyword="R,IDE"
LABEL oc.cat="development"
LABEL oc.desktopfile="org.kde.konsole.desktop"
LABEL oc.launch="ide.konsole"
LABEL oc.template="abcdesktopio/oc.template.ubuntu.nvidia.20.04"
LABEL oc.name="ide"
LABEL oc.displayname="Image Data Explorer"
LABEL oc.path="/usr/bin/konsole"
LABEL oc.args="--hold -e bash --rcfile /usr/local/bin/startide.sh"
LABEL oc.type=app
LABEL oc.showinview="dock"
LABEL oc.rules="{\"homedir\":{\"default\":true}}"
LABEL oc.acl="{\"permit\":[\"all\"]}"

RUN  if [ -d /usr/share/icons ]   && [ -x /composer/safelinks.sh ] && [ -d /usr/share/icons   ];  then cd /usr/share/icons;    /composer/safelinks.sh; fi 
RUN  if [ -d /usr/share/pixmaps ] && [ -x /composer/safelinks.sh ] && [ -d /usr/share/pixmaps ];  then cd /usr/share/pixmaps;  /composer/safelinks.sh; fi 
ENV APPNAME "ide"
ENV APPBIN "/usr/bin/konsole"
ENV APP "/usr/bin/konsole"
ENV ARGS "--hold -e bash --rcfile /usr/local/bin/startide.sh"
ENV LD_LIBRARY_PATH "/usr/local/nvidia/lib:/usr/local/nvidia/lib64",
ENV NVIDIA_DRIVER_CAPABILITIES "compute,utility"


RUN mkdir -p /run/user/
RUN chmod 777 /run/user
COPY startide.sh /usr/local/bin/startide.sh
RUN chmod 0755 /usr/local/bin/startide.sh
RUN mkdir -p /etc/localaccount
RUN for f in passwd shadow group gshadow ; do if [ -f /etc/$f ] ; then  cp /etc/$f /etc/localaccount; rm -f /etc/$f; ln -s /etc/localaccount/$f /etc/$f; fi; done

CMD [ "/composer/appli-docker-entrypoint.sh" ]


